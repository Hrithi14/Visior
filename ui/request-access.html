<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>VISIOR ‚Äî Request Access</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&family=Sora:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --primary: #4567B7;
    --primary-dark: #2f4f9f;
    --primary-light: #6b89d4;
    --primary-ultra: #eef2fb;
    --accent: #2de8b0;
    --danger: #e55353;
    --success: #22c55e;
    --warn: #f5a623;
    --bg: #f4f6fb;
    --surface: #ffffff;
    --surface2: #f8faff;
    --border: #dde4f5;
    --text: #1a2240;
    --text2: #4a5580;
    --text3: #8a96b8;
    --shadow-sm: 0 1px 4px rgba(69,103,183,0.07);
    --shadow: 0 4px 20px rgba(69,103,183,0.10);
    --shadow-lg: 0 8px 40px rgba(69,103,183,0.16);
    --radius: 12px;
    --radius-sm: 8px;
    --hh: 64px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); font-size: 14px; }

  #header {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    height: var(--hh); background: var(--primary);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 28px; box-shadow: 0 2px 16px rgba(30,50,120,0.22);
  }
  .logo-area { display: flex; align-items: center; gap: 14px; cursor: pointer; }
  .logo-shield { width: 36px; height: 36px; background: rgba(255,255,255,0.18); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
  .logo-text strong { font-family: 'Sora', sans-serif; font-size: 18px; letter-spacing: 1px; color: #fff; }
  .breadcrumb { display: flex; align-items: center; gap: 6px; color: rgba(255,255,255,0.65); font-size: 12px; margin-top: 2px; }
  .breadcrumb span { color: #fff; font-weight: 500; }
  .header-right { display: flex; align-items: center; gap: 14px; }
  .chain-live { display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.12); border-radius: 20px; padding: 5px 12px; color: #fff; font-size: 11.5px; }
  .cdot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: blink 2s infinite; }
  @keyframes blink { 0%,100%{opacity:1}50%{opacity:.35} }
  .profile-pill { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.14); border: 1px solid rgba(255,255,255,0.22); border-radius: 20px; padding: 6px 14px 6px 8px; color: #fff; font-size: 13px; cursor: pointer; }
  .avatar { width: 28px; height: 28px; border-radius: 50%; background: linear-gradient(135deg,#a5c0ff,#4567B7); display: flex; align-items: center; justify-content: center; font-size: 13px; }

  #main { margin-top: var(--hh); padding: 28px 32px 60px; max-width: 1100px; margin-left: auto; margin-right: auto; }

  .back-btn { display: inline-flex; align-items: center; gap: 7px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 8px 16px; font-size: 12.5px; font-weight: 500; color: var(--primary); cursor: pointer; margin-bottom: 20px; box-shadow: var(--shadow-sm); transition: box-shadow 0.18s; }
  .back-btn:hover { box-shadow: var(--shadow); }

  .page-title-block { margin-bottom: 24px; }
  .page-title-block h1 { font-family: 'Sora', sans-serif; font-size: 22px; font-weight: 700; color: var(--text); }
  .page-title-block p { font-size: 13px; color: var(--text3); margin-top: 4px; }

  .layout { display: grid; grid-template-columns: 1fr 300px; gap: 22px; align-items: start; }
  @media(max-width:900px){ .layout{grid-template-columns:1fr;} }

  .card { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); margin-bottom: 20px; overflow: hidden; }
  .card-hdr { display: flex; align-items: center; justify-content: space-between; padding: 14px 20px; border-bottom: 1px solid var(--border); background: var(--surface2); }
  .card-title { font-family: 'Sora', sans-serif; font-size: 13.5px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
  .card-body { padding: 22px; }
  .step-badge { background: var(--primary); color: #fff; border-radius: 50%; width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; }

  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .form-grid.cols1 { grid-template-columns: 1fr; }
  @media(max-width:650px){ .form-grid{ grid-template-columns:1fr; } }

  .field { display: flex; flex-direction: column; gap: 5px; }
  .field label { font-size: 11.5px; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: 0.4px; }
  .field label .req { color: var(--danger); }
  .field input, .field select, .field textarea { padding: 10px 13px; border-radius: var(--radius-sm); border: 1px solid var(--border); font-family: inherit; font-size: 13.5px; color: var(--text); background: var(--surface); outline: none; transition: border-color 0.18s, box-shadow 0.18s; }
  .field input:focus, .field select:focus, .field textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(69,103,183,0.12); }
  .field input.readonly { background: var(--surface2); color: var(--text2); cursor: default; }
  .field textarea { resize: vertical; min-height: 100px; }
  .field .hint { font-size: 11px; color: var(--text3); }

  .check-group { display: flex; flex-direction: column; gap: 10px; }
  .check-item { display: flex; align-items: flex-start; gap: 10px; cursor: pointer; padding: 10px 13px; border: 1px solid var(--border); border-radius: var(--radius-sm); transition: background 0.15s, border-color 0.15s; }
  .check-item:hover { background: var(--primary-ultra, #eef2fb); border-color: var(--primary-light); }
  .check-item input[type=checkbox] { margin-top: 1px; accent-color: var(--primary); width: 15px; height: 15px; flex-shrink: 0; cursor: pointer; }
  .check-item .check-label { font-size: 13px; color: var(--text); line-height: 1.4; }
  .check-item .check-sub { font-size: 11px; color: var(--text3); margin-top: 2px; }
  .check-item.required-ack.checked { background: #f0fdf4; border-color: var(--success); }

  .file-drop { border: 2px dashed var(--border); border-radius: var(--radius-sm); padding: 24px; text-align: center; cursor: pointer; transition: all 0.18s; background: var(--surface2); }
  .file-drop:hover, .file-drop.drag { border-color: var(--primary); background: var(--primary-ultra, #eef2fb); }
  .file-drop .icon { font-size: 28px; margin-bottom: 8px; }
  .file-drop p { font-size: 13px; color: var(--text2); }
  .file-drop span { font-size: 11.5px; color: var(--text3); }
  .file-info { display: flex; align-items: center; gap: 10px; padding: 10px 13px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: var(--radius-sm); margin-top: 10px; font-size: 12.5px; }
  .file-hash { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--text3); background: var(--surface); border-radius: 4px; padding: 2px 7px; }

  .sidebar { position: sticky; top: calc(var(--hh) + 20px); display: flex; flex-direction: column; gap: 18px; }

  .review-panel { background: linear-gradient(135deg, #4567B7 0%, #2f4f9f 100%); border-radius: var(--radius); padding: 20px; color: #fff; box-shadow: var(--shadow-lg); }
  .review-panel h3 { font-family: 'Sora', sans-serif; font-size: 14px; font-weight: 700; margin-bottom: 14px; }
  .reviewer { display: flex; align-items: center; gap: 10px; padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.12); }
  .reviewer:last-child { border-bottom: none; }
  .reviewer-icon { width: 30px; height: 30px; border-radius: 50%; background: rgba(255,255,255,0.16); display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
  .reviewer-name { font-size: 12.5px; font-weight: 500; }
  .reviewer-role { font-size: 10.5px; opacity: 0.7; }
  .chain-note { margin-top: 14px; font-size: 11px; opacity: 0.75; display: flex; align-items: flex-start; gap: 6px; line-height: 1.5; }

  .progress-card .card-body { padding: 16px 20px; }
  .progress-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; color: var(--text2); }
  .progress-track { height: 7px; background: var(--border); border-radius: 20px; overflow: hidden; margin-bottom: 14px; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-light), var(--primary)); border-radius: 20px; transition: width 0.5s ease; }
  .prog-steps { display: flex; flex-direction: column; gap: 8px; }
  .prog-step { display: flex; align-items: center; gap: 9px; font-size: 12.5px; color: var(--text3); }
  .prog-step.done { color: var(--text); }
  .prog-step .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--border); flex-shrink: 0; }
  .prog-step.done .dot { background: var(--success); }
  .prog-step.active .dot { background: var(--primary); animation: blink 1.5s infinite; }
  .prog-step.active { color: var(--primary); font-weight: 500; }

  .chain-status { padding: 14px 18px; border-radius: var(--radius-sm); background: var(--surface2); border: 1px solid var(--border); }
  .chain-row { display: flex; justify-content: space-between; font-size: 11.5px; margin-bottom: 7px; }
  .chain-row:last-child { margin-bottom: 0; }
  .chain-row .lbl { color: var(--text3); }
  .chain-row .val { font-family: 'DM Mono', monospace; color: var(--primary); font-size: 10.5px; font-weight: 500; }

  #action-bar { background: var(--surface); border-top: 1px solid var(--border); position: fixed; bottom: 0; left: 0; right: 0; z-index: 99; padding: 14px 32px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 -4px 20px rgba(69,103,183,0.08); }
  .action-left { font-size: 12px; color: var(--text3); }
  .action-left strong { color: var(--text); }
  .action-btns { display: flex; gap: 10px; }

  .btn { display: inline-flex; align-items: center; gap: 7px; border-radius: var(--radius-sm); border: none; font-family: inherit; font-weight: 500; cursor: pointer; font-size: 13.5px; padding: 10px 22px; transition: all 0.18s; }
  .btn-primary { background: var(--primary); color: #fff; box-shadow: 0 2px 12px rgba(69,103,183,0.3); }
  .btn-primary:hover { background: var(--primary-dark); }
  .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text2); }
  .btn-outline:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-ultra, #eef2fb); }
  .btn-danger-soft { background: #fee2e2; color: var(--danger); }
  .btn-danger-soft:hover { background: var(--danger); color: #fff; }
  .btn.loading { opacity: 0.7; pointer-events: none; }
  .spinner { display: inline-block; width: 13px; height: 13px; border: 2px solid rgba(255,255,255,0.35); border-top-color: #fff; border-radius: 50%; animation: spin 0.65s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  #toast-wrap { position: fixed; bottom: 80px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
  .toast { background: var(--surface); border: 1px solid var(--border); border-left: 4px solid var(--success); border-radius: var(--radius-sm); padding: 13px 17px; font-size: 13px; box-shadow: var(--shadow-lg); max-width: 350px; animation: tin .3s ease, tout .4s ease 3.2s forwards; }
  .toast.info { border-left-color: var(--primary); }
  .toast.error { border-left-color: var(--danger); }
  .toast-title { font-weight: 600; margin-bottom: 3px; }
  .toast-sub { font-size: 10.5px; color: var(--text3); font-family: 'DM Mono', monospace; word-break: break-all; }
  @keyframes tin { from{transform:translateX(30px);opacity:0}to{transform:none;opacity:1} }
  @keyframes tout { to{transform:translateX(30px);opacity:0} }

  #modal-overlay { display: none; position: fixed; inset: 0; background: rgba(15,25,60,0.55); z-index: 1000; align-items: center; justify-content: center; }
  #modal-overlay.show { display: flex; }
  .modal { background: var(--surface); border-radius: var(--radius); padding: 32px; max-width: 500px; width: 90%; box-shadow: var(--shadow-lg); animation: tin .3s ease; }
  .modal h2 { font-family: 'Sora', sans-serif; font-size: 18px; font-weight: 700; margin-bottom: 6px; }
  .modal p { font-size: 13px; color: var(--text2); margin-bottom: 18px; line-height: 1.6; }
  .modal-hash-box { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 14px; font-family: 'DM Mono', monospace; font-size: 11px; color: var(--primary); word-break: break-all; margin-bottom: 18px; }
  .modal-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 7px; }
  .modal-row .lbl { color: var(--text3); }
  .modal-row .val { font-weight: 500; font-family: 'DM Mono', monospace; color: var(--text); font-size: 11px; }
  .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 6px; }

  .val-error { background: #fee2e2; border: 1px solid #fca5a5; border-radius: var(--radius-sm); padding: 12px 16px; font-size: 12.5px; color: #991b1b; margin-bottom: 18px; display: none; }
  .val-error ul { padding-left: 18px; margin-top: 5px; }
  .val-error li { margin-bottom: 3px; }

  .footer-links {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 30px;
    padding: 20px 0;
    border-top: 1px solid var(--border);
  }

  .footer-links a {
    color: var(--text3);
    text-decoration: none;
    font-size: 12px;
    transition: color 0.2s;
  }

  .footer-links a:hover {
    color: var(--primary);
  }

  body { padding-bottom: 70px; }
  @media(max-width:600px){ #main{padding:16px 16px 60px;} #action-bar{padding:12px 16px;} .btn{font-size:12.5px;padding:9px 16px;} }
</style>
</head>
<body>

<header id="header">
  <div class="logo-area" onclick="window.location.href='home.html'">
    <div class="logo-shield">üõ°Ô∏è</div>
    <div>
      <div class="logo-text"><strong>VISIOR</strong></div>
      <div class="breadcrumb">VISIOR ‚Ä∫ Trials ‚Ä∫ <span>Request Access</span></div>
    </div>
  </div>
  <div class="header-right">
    <div class="chain-live"><span class="cdot"></span> Hyperledger Fabric ¬∑ ch-VISIOR-01</div>
    <div class="profile-pill" onclick="toggleProfile()"><div class="avatar">üë§</div> Dr. Sarah Smith</div>
  </div>
</header>

<div id="main">
  <button class="back-btn" onclick="window.location.href='trial-detail.html'">‚Üê Back to Trial Detail</button>

  <div class="page-title-block">
    <h1>Request Access to: CARDIO-PRECISION-II (Trial #VISIOR-T2-20240312)</h1>
    <p>Complete all required sections. Your request will be cryptographically submitted and reviewed by an authorized committee.</p>
  </div>

  <div class="val-error" id="val-error">
    <strong>Please fix the following before submitting:</strong>
    <ul id="val-error-list"></ul>
  </div>

  <div class="layout">

    <div class="form-col">

      <!-- Section 1 -->
      <div class="card">
        <div class="card-hdr">
          <div class="card-title"><span class="step-badge">1</span> Researcher Information</div>
          <span style="font-size:11px;color:var(--success);font-weight:600;">‚óè Auto-filled from profile</span>
        </div>
        <div class="card-body">
          <div class="form-grid">
            <div class="field"><label>Full Name <span class="req">*</span></label><input type="text" class="readonly" value="Dr. Sarah Smith" readonly /></div>
            <div class="field"><label>Institution <span class="req">*</span></label><input type="text" class="readonly" value="Johns Hopkins University" readonly /></div>
            <div class="field"><label>Department <span class="req">*</span></label><input type="text" class="readonly" value="Cardiovascular Medicine" readonly /></div>
            <div class="field"><label>Position <span class="req">*</span></label><input type="text" class="readonly" value="Associate Professor" readonly /></div>
            <div class="field"><label>ORCID ID <span class="req">*</span></label><input type="text" class="readonly" value="0000-0002-1234-5678" readonly /></div>
            <div class="field"><label>Access Tier</label><input type="text" class="readonly" value="Tier 2 ‚Äî Full Access Researcher" readonly /></div>
          </div>
        </div>
      </div>

      <!-- Section 2 -->
      <div class="card">
        <div class="card-hdr"><div class="card-title"><span class="step-badge">2</span> Research Purpose</div></div>
        <div class="card-body">
          <div class="form-grid cols1">
            <div class="field">
              <label>Title of Research <span class="req">*</span></label>
              <input type="text" id="f-title" placeholder="e.g. Cardiovascular Risk Stratification Using ML" />
              <span class="hint">Minimum 10 characters required.</span>
            </div>
            <div class="field">
              <label>Detailed Research Description <span class="req">*</span></label>
              <textarea id="f-desc" rows="5" placeholder="Describe your research objectives, methodology, and expected outcomes..."></textarea>
              <span class="hint">Minimum 100 characters required.</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 3 -->
      <div class="card">
        <div class="card-hdr"><div class="card-title"><span class="step-badge">3</span> Data Required</div></div>
        <div class="card-body">
          <div class="check-group" id="data-checks">
            <label class="check-item"><input type="checkbox" value="anonymized_patient" /><div><div class="check-label">Anonymized Patient Data</div><div class="check-sub">De-identified clinical records per HIPAA standards</div></div></label>
            <label class="check-item"><input type="checkbox" value="statistical_files" /><div><div class="check-label">Statistical Analysis Files</div><div class="check-sub">Pre-processed statistical outputs and datasets</div></div></label>
            <label class="check-item"><input type="checkbox" value="raw_lab" /><div><div class="check-label">Raw Laboratory Data</div><div class="check-sub">Unprocessed lab results and biomarker values</div></div></label>
            <label class="check-item"><input type="checkbox" value="imaging" /><div><div class="check-label">Imaging Data</div><div class="check-sub">Radiology, MRI, CT scans (anonymized DICOM)</div></div></label>
            <label class="check-item"><input type="checkbox" value="genomic" /><div><div class="check-label">Genomic Data</div><div class="check-sub">Sequencing data with privacy protection protocols applied</div></div></label>
          </div>
        </div>
      </div>

      <!-- Section 4 -->
      <div class="card">
        <div class="card-hdr"><div class="card-title"><span class="step-badge">4</span> Ethics Approval</div></div>
        <div class="card-body">
          <div class="form-grid" style="margin-bottom:18px;">
            <div class="field"><label>Ethics Committee Name <span class="req">*</span></label><input type="text" id="f-ethics-name" placeholder="e.g. Johns Hopkins IRB" /></div>
            <div class="field"><label>Approval Number <span class="req">*</span></label><input type="text" id="f-ethics-num" placeholder="e.g. IRB-2024-0312" /></div>
            <div class="field"><label>Approval Date <span class="req">*</span></label><input type="date" id="f-ethics-date" /></div>
            <div class="field"><label>Expiration Date <span class="req">*</span></label><input type="date" id="f-ethics-exp" /></div>
          </div>
          <div class="field">
            <label>Upload Ethics Approval Document <span class="req">*</span></label>
            <div class="file-drop" id="file-drop" onclick="document.getElementById('file-input').click()" ondragover="fileDrag(event,true)" ondragleave="fileDrag(event,false)" ondrop="fileDrop(event)">
              <div class="icon">üìÑ</div>
              <p>Click to upload or drag & drop</p>
              <span>PDF, DOC, DOCX ‚Äî max 10MB</span>
            </div>
            <input type="file" id="file-input" style="display:none" accept=".pdf,.doc,.docx" onchange="handleFile(this.files[0])" />
            <div id="file-info" style="display:none" class="file-info">
              <span>‚úÖ</span>
              <div><div id="file-name" style="font-weight:500;"></div><div class="file-hash" id="file-hash"></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 5 -->
      <div class="card">
        <div class="card-hdr"><div class="card-title"><span class="step-badge">5</span> Funding Source</div></div>
        <div class="card-body">
          <div class="check-group" id="funding-checks">
            <label class="check-item"><input type="checkbox" value="institutional" /><div class="check-label">Institutional Grant</div></label>
            <label class="check-item"><input type="checkbox" value="government" /><div class="check-label">Government Funding (NIH / NSF / Govt Agency)</div></label>
            <label class="check-item"><input type="checkbox" value="industry" /><div class="check-label">Industry Sponsorship</div></label>
            <label class="check-item"><input type="checkbox" value="unfunded" /><div class="check-label">Unfunded / Independent Research</div></label>
            <label class="check-item"><input type="checkbox" value="other" onchange="toggleOtherFunding(this)" /><div class="check-label">Other</div></label>
          </div>
          <div class="field" id="other-funding-wrap" style="display:none;margin-top:12px;">
            <label>Specify Funding Source</label>
            <input type="text" id="f-other-funding" placeholder="Describe funding source..." />
          </div>
        </div>
      </div>

      <!-- Section 6 -->
      <div class="card">
        <div class="card-hdr"><div class="card-title"><span class="step-badge">6</span> Publications Plan</div></div>
        <div class="card-body">
          <div class="field">
            <label>Publication & Dissemination Plan <span class="req">*</span></label>
            <textarea id="f-pub" rows="4" placeholder="Describe where and how you plan to publish findings, expected journals, open access commitments..."></textarea>
            <span class="hint">Minimum 50 characters required.</span>
          </div>
        </div>
      </div>

      <!-- Section 7 -->
      <div class="card">
        <div class="card-hdr">
          <div class="card-title"><span class="step-badge">7</span> Data Security Acknowledgments</div>
          <span style="font-size:11px;color:var(--danger);font-weight:600;">All required</span>
        </div>
        <div class="card-body">
          <div class="check-group" id="ack-checks">
            <label class="check-item required-ack" id="ack-1"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-1')" /><div><div class="check-label">I will not attempt to re-identify any patient in this dataset.</div></div></label>
            <label class="check-item required-ack" id="ack-2"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-2')" /><div><div class="check-label">I will store all data on encrypted, access-controlled systems compliant with institutional security policy.</div></div></label>
            <label class="check-item required-ack" id="ack-3"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-3')" /><div><div class="check-label">I will not share this data with any unauthorized third party.</div></div></label>
            <label class="check-item required-ack" id="ack-4"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-4')" /><div><div class="check-label">I understand that all actions on this platform are logged on blockchain and are auditable.</div></div></label>
            <label class="check-item required-ack" id="ack-5"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-5')" /><div><div class="check-label">I will securely delete all VISIOR data upon expiration of my access period.</div></div></label>
            <label class="check-item required-ack" id="ack-6"><input type="checkbox" class="ack-cb" onchange="ackToggle(this,'ack-6')" /><div><div class="check-label">I confirm that all information submitted in this request is accurate and truthful to the best of my knowledge.</div></div></label>
          </div>
          <div style="margin-top:14px;padding:12px 14px;background:#fffbeb;border:1px solid #fcd34d;border-radius:var(--radius-sm);font-size:12px;color:#78350f;">
            ‚ö†Ô∏è Submission is blocked until all six acknowledgments are checked. Your digital signature will be recorded on blockchain.
          </div>
        </div>
      </div>

    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="review-panel">
        <h3>üìã Your Request Will Be Reviewed By</h3>
        <div class="reviewer"><div class="reviewer-icon">üèõÔ∏è</div><div><div class="reviewer-name">FDA Regulator</div><div class="reviewer-role">Federal Drug Administration</div></div></div>
        <div class="reviewer"><div class="reviewer-icon">üè¢</div><div><div class="reviewer-name">Trial Sponsor</div><div class="reviewer-role">Cardiology Research Institute</div></div></div>
        <div class="reviewer"><div class="reviewer-icon">‚öñÔ∏è</div><div><div class="reviewer-name">Ethics Committee</div><div class="reviewer-role">Institutional Review Board</div></div></div>
        <div class="reviewer"><div class="reviewer-icon">ü§ù</div><div><div class="reviewer-name">Patient Advocate</div><div class="reviewer-role">Patient Rights Representative</div></div></div>
        <div class="reviewer"><div class="reviewer-icon">üî¨</div><div><div class="reviewer-name">Additional Researcher</div><div class="reviewer-role">Peer Scientific Review</div></div></div>
        <div class="chain-note">‚õì All votes and decisions are cryptographically recorded on blockchain with immutable audit trail.</div>
      </div>

      <div class="card progress-card">
        <div class="card-hdr"><div class="card-title">üìä Completion Progress</div></div>
        <div class="card-body" style="padding:16px 20px;">
          <div class="progress-label"><span>Form Completion</span><span id="prog-pct">0%</span></div>
          <div class="progress-track"><div class="progress-fill" id="prog-fill" style="width:0%"></div></div>
          <div class="prog-steps">
            <div class="prog-step done" id="ps-1"><span class="dot"></span> Researcher Info</div>
            <div class="prog-step" id="ps-2"><span class="dot"></span> Research Purpose</div>
            <div class="prog-step" id="ps-3"><span class="dot"></span> Data Required</div>
            <div class="prog-step" id="ps-4"><span class="dot"></span> Ethics Approval</div>
            <div class="prog-step" id="ps-5"><span class="dot"></span> Funding Source</div>
            <div class="prog-step" id="ps-6"><span class="dot"></span> Publications Plan</div>
            <div class="prog-step" id="ps-7"><span class="dot"></span> Acknowledgments</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><div class="card-title">‚õì Blockchain Status</div></div>
        <div class="card-body" style="padding:14px 18px;">
          <div class="chain-status">
            <div class="chain-row"><span class="lbl">Network</span><span class="val">Hyperledger Fabric</span></div>
            <div class="chain-row"><span class="lbl">Channel</span><span class="val">ch-VISIOR-clinical-01</span></div>
            <div class="chain-row"><span class="lbl">Block Height</span><span class="val" id="block-h">2,891,452</span></div>
            <div class="chain-row"><span class="lbl">Request Hash</span><span class="val" id="req-hash">‚Äî</span></div>
            <div class="chain-row"><span class="lbl">Draft TX</span><span class="val" id="draft-tx">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

  </div>
  
  <!-- Footer Links -->
  <div class="footer-links">
    <a href="help.html">Help</a>
    <a href="privacy.html">Privacy</a>
    <a href="terms.html">Terms</a>
    <a href="contact.html">Contact</a>
  </div>
</div>

<div id="action-bar">
  <div class="action-left">Trial: <strong>CARDIO-PRECISION-II</strong> &nbsp;¬∑&nbsp; <span id="ack-count" style="color:var(--text3);">0/6 acknowledgments</span></div>
  <div class="action-btns">
    <button class="btn btn-danger-soft" onclick="window.location.href='trial-detail.html'">‚úï Cancel</button>
    <button class="btn btn-outline" onclick="saveDraft()">üíæ Save Draft</button>
    <button class="btn btn-primary" id="submit-btn" onclick="submitRequest()">Submit Request ‚Üí</button>
  </div>
</div>

<div id="modal-overlay">
  <div class="modal">
    <h2>‚úÖ Request Submitted Successfully</h2>
    <p>Your access request has been hashed, signed, and logged on the blockchain. The review committee has been notified and will vote on your request.</p>
    <div class="modal-hash-box" id="modal-hash">‚Äî</div>
    <div class="modal-row"><span class="lbl">Request ID</span><span class="val" id="modal-req-id">‚Äî</span></div>
    <div class="modal-row"><span class="lbl">Blockchain TX</span><span class="val" id="modal-tx">‚Äî</span></div>
    <div class="modal-row"><span class="lbl">Block Number</span><span class="val" id="modal-block">‚Äî</span></div>
    <div class="modal-row"><span class="lbl">Channel</span><span class="val">ch-VISIOR-clinical-01</span></div>
    <div class="modal-row"><span class="lbl">Timestamp</span><span class="val" id="modal-ts">‚Äî</span></div>
    <div class="modal-row"><span class="lbl">Status</span><span class="val" style="color:var(--warn);">üîÑ Pending Committee Review</span></div>
    <div class="modal-btns">
      <button class="btn btn-outline" onclick="closeModal()">Close</button>
      <button class="btn btn-primary" onclick="window.location.href='researcher-dashbord.html'">Go to Dashboard ‚Üí</button>
    </div>
  </div>
</div>

<div id="toast-wrap"></div>

<script>
function toggleProfile() {
  window.location.href = 'profile.html';
}

function rh(n){ return [...Array(n)].map(()=>Math.floor(Math.random()*16).toString(16)).join(''); }
function genTx(){ return '0x'+rh(40); }
function genReqId(){ return 'REQ-'+Date.now().toString(36).toUpperCase(); }
function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }

let ackCount = 0;
let fileUploaded = false;

function toast(title, sub='', type='success'){
  const w = document.getElementById('toast-wrap');
  const t = document.createElement('div');
  t.className = 'toast '+type;
  t.innerHTML = `<div class="toast-title">${title}</div>${sub?`<div class="toast-sub">${sub}</div>`:''}`;
  w.appendChild(t);
  setTimeout(()=>t.remove(), 3800);
}

function ackToggle(cb, id){
  const el = document.getElementById(id);
  if(cb.checked){ el.classList.add('checked'); ackCount++; }
  else { el.classList.remove('checked'); ackCount--; }
  document.getElementById('ack-count').textContent = ackCount+'/6 acknowledgments';
  document.getElementById('ack-count').style.color = ackCount>=6 ? 'var(--success)' : 'var(--text3)';
  updateProgress();
}

function toggleOtherFunding(cb){
  document.getElementById('other-funding-wrap').style.display = cb.checked ? 'flex' : 'none';
}

function fileDrag(e, on){ e.preventDefault(); document.getElementById('file-drop').classList.toggle('drag', on); }
function fileDrop(e){ e.preventDefault(); fileDrag(e, false); handleFile(e.dataTransfer.files[0]); }

async function handleFile(file){
  if(!file) return;
  if(file.size > 10*1024*1024){ toast('File too large (max 10MB)','','error'); return; }
  document.getElementById('file-name').textContent = file.name + ' (' + (file.size/1024).toFixed(1) + ' KB)';
  const hash = '0x' + rh(32);
  document.getElementById('file-hash').textContent = 'SHA-256: ' + hash;
  document.getElementById('file-info').style.display = 'flex';
  fileUploaded = true;
  document.getElementById('req-hash').textContent = hash.substring(0,18)+'‚Ä¶';
  toast('File uploaded & hashed', hash, 'success');
  updateProgress();
}

function updateProgress(){
  const checks = [
    true,
    (document.getElementById('f-title').value.length >= 10 && document.getElementById('f-desc').value.length >= 100),
    [...document.querySelectorAll('#data-checks input:checked')].length > 0,
    (document.getElementById('f-ethics-name').value && document.getElementById('f-ethics-num').value && document.getElementById('f-ethics-date').value && document.getElementById('f-ethics-exp').value && fileUploaded),
    [...document.querySelectorAll('#funding-checks input:checked')].length > 0,
    document.getElementById('f-pub').value.length >= 50,
    ackCount >= 6
  ];
  const done = checks.filter(Boolean).length;
  const pct = Math.round((done/7)*100);
  document.getElementById('prog-fill').style.width = pct + '%';
  document.getElementById('prog-pct').textContent = pct + '%';
  ['ps-1','ps-2','ps-3','ps-4','ps-5','ps-6','ps-7'].forEach((id,i)=>{
    document.getElementById(id).className = 'prog-step ' + (checks[i] ? 'done' : (i === done ? 'active' : ''));
  });
}

function validate(){
  const errors = [];
  if(document.getElementById('f-title').value.trim().length < 10) errors.push('Research title must be at least 10 characters.');
  if(document.getElementById('f-desc').value.trim().length < 100) errors.push('Research description must be at least 100 characters.');
  if([...document.querySelectorAll('#data-checks input:checked')].length === 0) errors.push('Select at least one data type required.');
  if(!document.getElementById('f-ethics-name').value.trim()) errors.push('Ethics committee name is required.');
  if(!document.getElementById('f-ethics-num').value.trim()) errors.push('Ethics approval number is required.');
  if(!document.getElementById('f-ethics-date').value) errors.push('Ethics approval date is required.');
  if(!document.getElementById('f-ethics-exp').value) errors.push('Ethics expiration date is required.');
  if(!fileUploaded) errors.push('Ethics approval document must be uploaded.');
  if([...document.querySelectorAll('#funding-checks input:checked')].length === 0) errors.push('Select at least one funding source.');
  if(document.getElementById('f-pub').value.trim().length < 50) errors.push('Publications plan must be at least 50 characters.');
  if(ackCount < 6) errors.push('All 6 data security acknowledgments must be checked.');
  return errors;
}

async function saveDraft(){
  const btn = document.querySelector('.btn-outline[onclick="saveDraft()"]');
  btn.classList.add('loading'); btn.innerHTML = '<span class="spinner"></span> Saving‚Ä¶';
  await delay(1000);
  const tx = genTx();
  document.getElementById('draft-tx').textContent = tx.substring(0,14)+'‚Ä¶';
  const bh = parseInt(document.getElementById('block-h').textContent.replace(/,/g,''))+1;
  document.getElementById('block-h').textContent = bh.toLocaleString();
  btn.classList.remove('loading'); btn.innerHTML = 'üíæ Save Draft';
  toast('Draft saved to database & blockchain', tx, 'success');
}

async function submitRequest(){
  const errors = validate();
  const errBox = document.getElementById('val-error');
  const errList = document.getElementById('val-error-list');
  if(errors.length > 0){
    errBox.style.display = 'block';
    errList.innerHTML = errors.map(e=>`<li>${e}</li>`).join('');
    errBox.scrollIntoView({behavior:'smooth',block:'start'});
    toast('Please fix '+errors.length+' error(s)','','error');
    return;
  }
  errBox.style.display = 'none';
  const btn = document.getElementById('submit-btn');
  btn.classList.add('loading'); btn.innerHTML = '<span class="spinner"></span> Submitting‚Ä¶';
  toast('Validating form‚Ä¶','','info'); await delay(600);
  toast('Generating request hash‚Ä¶','','info'); await delay(700);
  toast('Signing & logging to Hyperledger Fabric‚Ä¶','','info'); await delay(900);
  const tx = genTx();
  const reqId = genReqId();
  const bh = parseInt(document.getElementById('block-h').textContent.replace(/,/g,''))+2;
  document.getElementById('block-h').textContent = bh.toLocaleString();
  document.getElementById('req-hash').textContent = tx.substring(0,16)+'‚Ä¶';
  document.getElementById('modal-hash').textContent = tx;
  document.getElementById('modal-req-id').textContent = reqId;
  document.getElementById('modal-tx').textContent = tx.substring(0,22)+'‚Ä¶';
  document.getElementById('modal-block').textContent = bh.toLocaleString();
  document.getElementById('modal-ts').textContent = new Date().toISOString();
  btn.classList.remove('loading'); btn.innerHTML = '‚úì Submitted'; btn.style.background = 'var(--success)';
  document.getElementById('modal-overlay').classList.add('show');
  toast('Request submitted & logged on blockchain', tx, 'success');
}

function closeModal(){ document.getElementById('modal-overlay').classList.remove('show'); }

['f-title','f-desc','f-pub'].forEach(id=>document.getElementById(id).addEventListener('input', updateProgress));
['f-ethics-name','f-ethics-num','f-ethics-date','f-ethics-exp'].forEach(id=>document.getElementById(id).addEventListener('input', updateProgress));
document.querySelectorAll('#data-checks input, #funding-checks input').forEach(cb=>cb.addEventListener('change', updateProgress));

setInterval(()=>{
  const el = document.getElementById('block-h');
  if(el){ const n = parseInt(el.textContent.replace(/,/g,''))+1; el.textContent = n.toLocaleString(); }
}, 12000);

updateProgress();
</script>
</body>
</html>