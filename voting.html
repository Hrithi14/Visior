<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>VISIOR ‚Äî Voting Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&family=Sora:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root {
    --primary: #4567B7; --primary-dark: #2f4f9f; --primary-light: #6b89d4;
    --primary-ultra: #eef2fb; --accent: #2de8b0; --danger: #e55353;
    --success: #22c55e; --warn: #f5a623; --bg: #f4f6fb; --surface: #ffffff;
    --surface2: #f8faff; --border: #dde4f5; --text: #1a2240; --text2: #4a5580;
    --text3: #8a96b8; --shadow-sm: 0 1px 4px rgba(69,103,183,0.07);
    --shadow: 0 4px 20px rgba(69,103,183,0.10); --shadow-lg: 0 8px 40px rgba(69,103,183,0.16);
    --radius: 12px; --radius-sm: 8px; --hh: 64px; --nh: 48px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); font-size: 14px; overflow-x: hidden; }

  #header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; height: var(--hh); background: var(--primary); display: flex; align-items: center; justify-content: space-between; padding: 0 28px; box-shadow: 0 2px 16px rgba(30,50,120,0.22); }
  .logo-area { display: flex; align-items: center; gap: 14px; cursor: pointer; }
  .logo-shield { width: 36px; height: 36px; background: rgba(255,255,255,0.18); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
  .logo-text strong { font-family: 'Sora', sans-serif; font-size: 18px; letter-spacing: 1px; color: #fff; }
  .breadcrumb { display: flex; align-items: center; gap: 5px; color: rgba(255,255,255,0.6); font-size: 11.5px; margin-top: 2px; }
  .breadcrumb span { color: #fff; font-weight: 500; }
  .header-right { display: flex; align-items: center; gap: 12px; }
  .chain-badge { display: flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.12); border-radius: 20px; padding: 5px 12px; color: #fff; font-size: 11px; }
  .cdot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:.35} }
  .profile-pill { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.14); border: 1px solid rgba(255,255,255,0.22); border-radius: 20px; padding: 5px 14px 5px 8px; color: #fff; font-size: 12.5px; cursor: pointer; }
  .avatar { width: 26px; height: 26px; border-radius: 50%; background: linear-gradient(135deg,#f5a623,#e55353); display: flex; align-items: center; justify-content: center; font-size: 12px; }
  .logout-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.25); color: #fff; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-family: inherit; transition: background 0.2s; }
  .logout-btn:hover { background: rgba(229,83,83,0.5); }

  #navbar { position: fixed; top: var(--hh); left: 0; right: 0; z-index: 99; height: var(--nh); background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 28px; gap: 4px; box-shadow: var(--shadow-sm); }
  .nav-link { padding: 7px 15px; border-radius: 8px; color: var(--text2); font-weight: 500; font-size: 13px; cursor: pointer; transition: all 0.18s; }
  .nav-link:hover { background: var(--primary-ultra); color: var(--primary); }
  .nav-link.active { background: var(--primary-ultra); color: var(--primary); font-weight: 600; }
  .nav-link.nav-logout { margin-left: auto; color: var(--danger); }
  .nav-link.nav-logout:hover { background: #fff0f0; }

  #main { margin-top: calc(var(--hh) + var(--nh)); min-height: calc(100vh - var(--hh) - var(--nh)); padding: 24px 28px 50px; max-width: 1400px; margin-left: auto; margin-right: auto; }

  .page-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 22px; }
  .page-header h1 { font-family: 'Sora', sans-serif; font-size: 20px; font-weight: 700; }
  .page-header p { font-size: 12.5px; color: var(--text3); margin-top: 3px; }
  .role-badge { display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg,#4567B7,#2f4f9f); color: #fff; border-radius: 20px; padding: 7px 16px; font-size: 12px; font-weight: 600; }

  .stats-strip { display: grid; grid-template-columns: repeat(5,1fr); gap: 1px; background: var(--border); border-radius: var(--radius); overflow: hidden; margin-bottom: 22px; }
  .stat-cell { background: var(--surface); padding: 16px 18px; }
  .stat-num { font-family: 'Sora', sans-serif; font-size: 24px; font-weight: 700; color: var(--primary); line-height: 1; }
  .stat-label { font-size: 11px; color: var(--text3); margin-top: 4px; }
  .stat-sub { font-size: 10.5px; margin-top: 3px; color: var(--warn); }
  @media(max-width:800px){ .stats-strip{grid-template-columns:repeat(2,1fr);} }

  .section-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .section-hdr h2 { font-family: 'Sora', sans-serif; font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
  .live-tag { display: inline-flex; align-items: center; gap: 5px; background: #dcfce7; color: #15803d; border-radius: 20px; padding: 3px 10px; font-size: 10.5px; font-weight: 600; }
  .live-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 1.5s infinite; }
  .pending-count { display: inline-flex; align-items: center; justify-content: center; background: var(--danger); color: #fff; border-radius: 50%; width: 22px; height: 22px; font-size: 11px; font-weight: 700; }

  .vote-grid { display: flex; flex-direction: column; gap: 22px; }
  .vote-card { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); overflow: hidden; transition: box-shadow 0.2s; }
  .vote-card:hover { box-shadow: var(--shadow-lg); }
  .vote-card.voted { border-color: #bbf7d0; }
  .vote-card.voted .vote-card-header { background: #f0fdf4; }

  .vote-card-header { background: var(--surface2); padding: 14px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
  .vote-type-tag { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; padding: 3px 10px; border-radius: 20px; }
  .tag-access { background: var(--primary-ultra); color: var(--primary); }
  .tag-membership { background: #fef3c7; color: #92400e; }
  .vote-id { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text3); }
  .vote-deadline { display: flex; align-items: center; gap: 5px; font-size: 11.5px; color: var(--warn); font-weight: 500; }

  .vote-card-body { display: grid; grid-template-columns: 1fr 260px 240px; gap: 0; }
  @media(max-width:1000px){ .vote-card-body{grid-template-columns:1fr;} }

  .vote-info { padding: 20px; border-right: 1px solid var(--border); }
  .applicant-row { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
  .applicant-avatar { width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-ultra), var(--primary-light)); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  .applicant-name { font-weight: 600; font-size: 15px; }
  .applicant-meta { font-size: 12px; color: var(--text3); margin-top: 2px; }

  .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 14px; }
  .info-item .lbl { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; color: var(--text3); margin-bottom: 3px; }
  .info-item .val { font-size: 12.5px; color: var(--text); font-weight: 500; }
  .info-item .val.mono { font-family: 'DM Mono', monospace; font-size: 11px; }

  .purpose-preview { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px 14px; margin-bottom: 12px; }
  .purpose-preview p { font-size: 12.5px; color: var(--text2); line-height: 1.6; }
  .link-btn { display: inline-flex; align-items: center; gap: 5px; font-size: 12px; color: var(--primary); font-weight: 500; cursor: pointer; padding: 0; background: none; border: none; }
  .link-btn:hover { text-decoration: underline; }

  .ethics-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: var(--radius-sm); font-size: 12px; margin-bottom: 12px; }
  .ethics-row .label { color: var(--text3); }
  .ethics-row .val { font-weight: 600; }

  .bias-section { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px 14px; }
  .bias-title { font-size: 10.5px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text3); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
  .bias-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 7px; font-size: 12px; }
  .bias-row:last-child { margin-bottom: 0; }
  .bias-label { color: var(--text2); }
  .bias-status { display: flex; align-items: center; gap: 4px; font-weight: 600; font-size: 11px; }
  .bias-status.pass { color: var(--success); }
  .bias-status.warn { color: var(--warn); }
  .bias-bar-wrap { flex: 1; height: 5px; background: #e8edfa; border-radius: 20px; overflow: hidden; margin: 0 10px; }
  .bias-bar { height: 100%; border-radius: 20px; }
  .bias-bar.high { background: var(--success); }
  .bias-bar.med { background: var(--warn); }

  .vote-status-panel { padding: 20px; border-right: 1px solid var(--border); }
  .vs-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text3); margin-bottom: 14px; }
  .vote-progress-wrap { margin-bottom: 16px; }
  .vote-prog-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--text2); margin-bottom: 6px; }
  .vote-prog-track { height: 10px; background: var(--border); border-radius: 20px; overflow: hidden; }
  .vote-prog-fill { height: 100%; border-radius: 20px; background: linear-gradient(90deg,var(--primary-light),var(--primary)); transition: width 0.6s ease; }

  .voter-list { display: flex; flex-direction: column; gap: 7px; }
  .voter-item { display: flex; align-items: center; justify-content: space-between; padding: 7px 10px; border-radius: var(--radius-sm); background: var(--surface2); border: 1px solid var(--border); }
  .voter-name { font-size: 12px; font-weight: 500; display: flex; align-items: center; gap: 7px; }
  .voter-role { font-size: 10px; color: var(--text3); }
  .vote-result { font-size: 11px; font-weight: 600; padding: 2px 9px; border-radius: 20px; }
  .vote-result.approved { background: #dcfce7; color: #15803d; }
  .vote-result.rejected { background: #fee2e2; color: #991b1b; }
  .vote-result.pending { background: var(--primary-ultra); color: var(--primary); }
  .vote-result.abstain { background: #f1f5f9; color: #475569; }

  .deadline-box { margin-top: 14px; padding: 10px 13px; background: #fffbeb; border: 1px solid #fcd34d; border-radius: var(--radius-sm); }
  .deadline-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.4px; color: #92400e; margin-bottom: 4px; }
  .countdown { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 700; color: var(--warn); }

  .vote-action-panel { padding: 20px; }
  .va-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text3); margin-bottom: 14px; }
  .vote-options { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
  .vote-option { display: flex; align-items: center; gap: 10px; padding: 11px 14px; border: 2px solid var(--border); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.18s; font-size: 13px; font-weight: 500; }
  .vote-option:hover { border-color: var(--primary); background: var(--primary-ultra); }
  .vote-option.selected-approve { border-color: var(--success); background: #f0fdf4; color: #15803d; }
  .vote-option.selected-reject { border-color: var(--danger); background: #fee2e2; color: #991b1b; }
  .vote-option.selected-info { border-color: var(--warn); background: #fffbeb; color: #92400e; }
  .vote-option.selected-conditional { border-color: var(--primary); background: var(--primary-ultra); color: var(--primary); }
  .vote-option input[type=radio] { accent-color: var(--primary); width: 15px; height: 15px; flex-shrink: 0; }
  .opt-icon { font-size: 16px; }

  .comment-field textarea { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: 12.5px; color: var(--text); resize: vertical; outline: none; transition: border-color 0.18s; background: var(--surface); min-height: 70px; }
  .comment-field textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(69,103,183,0.1); }
  .comment-field label { font-size: 10.5px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.4px; display: block; margin-bottom: 5px; }

  .submit-vote-btn { width: 100%; margin-top: 12px; padding: 11px; border: none; border-radius: var(--radius-sm); background: var(--primary); color: #fff; font-family: inherit; font-size: 13.5px; font-weight: 600; cursor: pointer; transition: all 0.18s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 2px 12px rgba(69,103,183,0.28); }
  .submit-vote-btn:hover { background: var(--primary-dark); }
  .submit-vote-btn:disabled { opacity: 0.6; pointer-events: none; }
  .submit-vote-btn.voted-state { background: var(--success); }

  .chain-mini { margin-top: 12px; padding: 10px 12px; background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); }
  .chain-mini-row { display: flex; justify-content: space-between; font-size: 10.5px; margin-bottom: 4px; }
  .chain-mini-row:last-child { margin-bottom: 0; }
  .chain-mini-row .k { color: var(--text3); }
  .chain-mini-row .v { font-family: 'DM Mono', monospace; color: var(--primary); font-size: 10px; }

  .inst-flags { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
  .inst-flag { padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 500; background: var(--primary-ultra); color: var(--primary); }

  #toast-wrap { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
  .toast { background: var(--surface); border: 1px solid var(--border); border-left: 4px solid var(--success); border-radius: var(--radius-sm); padding: 13px 17px; font-size: 13px; box-shadow: var(--shadow-lg); max-width: 360px; animation: tin .3s ease, tout .4s ease 3.4s forwards; }
  .toast.info { border-left-color: var(--primary); }
  .toast.error { border-left-color: var(--danger); }
  .toast-title { font-weight: 600; margin-bottom: 3px; }
  .toast-sub { font-size: 10.5px; color: var(--text3); font-family: 'DM Mono', monospace; word-break: break-all; }
  @keyframes tin { from{transform:translateX(30px);opacity:0}to{transform:none;opacity:1} }
  @keyframes tout { to{transform:translateX(30px);opacity:0} }

  #modal-overlay { display: none; position: fixed; inset: 0; background: rgba(15,25,60,0.55); z-index: 1000; align-items: center; justify-content: center; }
  #modal-overlay.show { display: flex; }
  .modal { background: var(--surface); border-radius: var(--radius); padding: 30px; max-width: 520px; width: 92%; box-shadow: var(--shadow-lg); animation: tin .3s ease; }
  .modal h2 { font-family: 'Sora', sans-serif; font-size: 17px; font-weight: 700; margin-bottom: 6px; }
  .modal p { font-size: 13px; color: var(--text2); margin-bottom: 16px; line-height: 1.6; }
  .modal-hash { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 12px 14px; font-family: 'DM Mono', monospace; font-size: 10.5px; color: var(--primary); word-break: break-all; margin-bottom: 16px; }
  .modal-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 7px; }
  .modal-row .k { color: var(--text3); }
  .modal-row .v { font-family: 'DM Mono', monospace; font-size: 11px; font-weight: 500; }
  .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
  .btn { display: inline-flex; align-items: center; gap: 6px; border-radius: var(--radius-sm); border: none; font-family: inherit; font-weight: 500; cursor: pointer; font-size: 13px; padding: 9px 20px; transition: all 0.18s; }
  .btn-primary { background: var(--primary); color: #fff; }
  .btn-primary:hover { background: var(--primary-dark); }
  .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text2); }
  .btn-outline:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-ultra); }

  #proposal-modal { display: none; position: fixed; inset: 0; background: rgba(15,25,60,0.55); z-index: 1000; align-items: center; justify-content: center; }
  #proposal-modal.show { display: flex; }
  .proposal-modal-box { background: var(--surface); border-radius: var(--radius); padding: 30px; max-width: 600px; width: 92%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-lg); animation: tin .3s ease; }
  .proposal-modal-box h2 { font-family: 'Sora', sans-serif; font-size: 16px; font-weight: 700; margin-bottom: 14px; }
  .prop-section { margin-bottom: 16px; }
  .prop-section h4 { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text3); margin-bottom: 6px; }
  .prop-section p { font-size: 13px; color: var(--text2); line-height: 1.6; }

  .spinner { width: 13px; height: 13px; border: 2px solid rgba(255,255,255,.35); border-top-color: #fff; border-radius: 50%; animation: spin .6s linear infinite; display: inline-block; }
  @keyframes spin { to{transform:rotate(360deg)} }

  .footer-links {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 40px;
    padding: 20px 0;
    border-top: 1px solid var(--border);
  }

  .footer-links a {
    color: var(--text3);
    text-decoration: none;
    font-size: 12px;
    transition: color 0.2s;
  }

  .footer-links a:hover {
    color: var(--primary);
  }

  @media(max-width:600px){ #main{padding:16px 14px 40px;} }
</style>
</head>
<body>

<header id="header">
  <div class="logo-area" onclick="window.location.href='home.html'">
    <div class="logo-shield">üõ°Ô∏è</div>
    <div>
      <div class="logo-text"><strong>VISIOR</strong></div>
      <div class="breadcrumb">VISIOR ‚Ä∫ <span>Voting</span></div>
    </div>
  </div>
  <div class="header-right">
    <div class="chain-badge"><span class="cdot"></span> Hyperledger Fabric ¬∑ ch-VISIOR-gov</div>
    <div class="profile-pill" onclick="window.location.href='profile.html'"><div class="avatar">‚öñÔ∏è</div> FDA Admin</div>
    <button class="logout-btn" onclick="confirmLogout()">Logout</button>
  </div>
</header>

<nav id="navbar">
  <a class="nav-link" onclick="window.location.href='pi-dashboard.html'">Dashboard</a>
  <a class="nav-link" onclick="window.location.href='home.html'">Trials</a>
  <a class="nav-link active" onclick="window.location.href='voting.html'">Voting</a>
  <a class="nav-link" onclick="window.location.href='members.html'">Members</a>
  <a class="nav-link" onclick="window.location.href='audit-log.html'">Audit</a>
  <a class="nav-link" onclick="window.location.href='profile.html'">Profile</a>
  <a class="nav-link nav-logout" onclick="confirmLogout()">‚éã Logout</a>
</nav>

<div id="main">
  <div class="page-header">
    <div>
      <h1>Governance Voting Dashboard</h1>
      <p>Review and cast binding votes. All decisions are cryptographically logged on blockchain.</p>
    </div>
    <div class="role-badge">‚öñÔ∏è FDA Regulatory Admin ¬∑ Tier 1 Voter</div>
  </div>

  <div class="stats-strip">
    <div class="stat-cell"><div class="stat-num" id="s-pending">2</div><div class="stat-label">Pending Your Vote</div><div class="stat-sub">Action required</div></div>
    <div class="stat-cell"><div class="stat-num" id="s-total">7</div><div class="stat-label">Total Active Votes</div></div>
    <div class="stat-cell"><div class="stat-num" id="s-cast">34</div><div class="stat-label">Votes Cast (30d)</div></div>
    <div class="stat-cell"><div class="stat-num" id="s-approved">28</div><div class="stat-label">Approved (30d)</div></div>
    <div class="stat-cell"><div class="stat-num" id="s-block">2,891,509</div><div class="stat-label">Block Height</div></div>
  </div>

  <div class="section-hdr">
    <h2>üó≥ Pending Votes <span class="pending-count" id="pending-badge">2</span> <span class="live-tag"><span class="live-dot"></span>Live</span></h2>
    <span style="font-size:12px;color:var(--text3);">All votes logged on Hyperledger Fabric ¬∑ ch-VISIOR-gov</span>
  </div>

  <div class="vote-grid">

    <!-- VOTE CARD 1 ‚Äî RESEARCHER ACCESS -->
    <div class="vote-card" id="card-1">
      <div class="vote-card-header">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="vote-type-tag tag-access">üî¨ Researcher Access Request</span>
          <span class="vote-id">VOTE-ID: VT-2024-0831</span>
        </div>
        <div style="display:flex;align-items:center;gap:16px;">
          <div class="vote-deadline">‚è± Closes in <span class="countdown" id="cd-1">47:22:11</span></div>
          <span style="font-size:11px;color:var(--text3);">Submitted: 2024-08-28</span>
        </div>
      </div>
      <div class="vote-card-body">
        <div class="vote-info">
          <div class="applicant-row">
            <div class="applicant-avatar">üë©‚Äçüî¨</div>
            <div>
              <div class="applicant-name">Dr. Sarah Smith</div>
              <div class="applicant-meta">Johns Hopkins University ¬∑ Cardiovascular Medicine</div>
              <div class="applicant-meta">ORCID: 0000-0002-1234-5678 ¬∑ Tier 2 Researcher</div>
            </div>
          </div>
          <div class="info-grid">
            <div class="info-item"><div class="lbl">Trial</div><div class="val">CARDIO-PRECISION-II</div></div>
            <div class="info-item"><div class="lbl">Trial ID</div><div class="val mono">VISIOR-T2-20240312</div></div>
            <div class="info-item"><div class="lbl">Data Requested</div><div class="val">Anonymized Patient + Statistical Files</div></div>
            <div class="info-item"><div class="lbl">Funding</div><div class="val">NIH Government Grant</div></div>
          </div>
          <div class="purpose-preview"><p>"Multi-site cardiovascular risk stratification using machine learning on longitudinal patient cohorts. Aims to improve early detection rates by 23% using federated learning architecture..."</p></div>
          <button class="link-btn" onclick="window.location.href='proposal-view.html'">üìÑ View Full Proposal ‚Üí</button>
          <div class="ethics-row" style="margin-top:12px;">
            <span>‚öñÔ∏è</span><span class="label">Ethics:</span><span class="val">IRB-JHU-2024-0312</span>
            <span class="label" style="margin-left:10px;">Exp:</span><span class="val">2025-03-12</span>
            <button class="link-btn" style="margin-left:auto;" onclick="toast2('Opening ethics document‚Ä¶','','info')">üìé View Doc</button>
          </div>
          <div class="bias-section" style="margin-top:12px;">
            <div class="bias-title">ü§ñ Automated ML Bias & Integrity Check</div>
            <div class="bias-row"><span class="bias-label">Bias Detection</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:92%"></div></div><span class="bias-status pass">‚úì Low Bias (92%)</span></div>
            <div class="bias-row"><span class="bias-label">Scientific Alignment</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:88%"></div></div><span class="bias-status pass">‚úì High (88%)</span></div>
            <div class="bias-row"><span class="bias-label">Conflict of Interest</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:100%"></div></div><span class="bias-status pass">‚úì None Detected</span></div>
            <div class="bias-row"><span class="bias-label">Data Sufficiency</span><div class="bias-bar-wrap"><div class="bias-bar med" style="width:65%"></div></div><span class="bias-status warn">‚ö† Moderate (65%)</span></div>
          </div>
        </div>
        <div class="vote-status-panel">
          <div class="vs-title">üìä Live Vote Status</div>
          <div class="vote-progress-wrap">
            <div class="vote-prog-label"><span>Votes Received</span><span id="vp1-count">2 of 5</span></div>
            <div class="vote-prog-track"><div class="vote-prog-fill" id="vp1-fill" style="width:40%"></div></div>
          </div>
          <div class="voter-list" id="voter-list-1">
            <div class="voter-item"><div><div class="voter-name">üèõÔ∏è FDA Regulator</div><div class="voter-role">Your Vote</div></div><span class="vote-result pending" id="my-vote-1">‚åõ Pending</span></div>
            <div class="voter-item"><div><div class="voter-name">üè¢ Trial Sponsor</div><div class="voter-role">Cardiology Research Inst.</div></div><span class="vote-result approved">‚úì Approved</span></div>
            <div class="voter-item"><div><div class="voter-name">‚öñÔ∏è Ethics Committee</div><div class="voter-role">Institutional IRB</div></div><span class="vote-result approved">‚úì Approved</span></div>
            <div class="voter-item"><div><div class="voter-name">ü§ù Patient Advocate</div><div class="voter-role">Patient Rights Rep.</div></div><span class="vote-result pending">‚åõ Pending</span></div>
            <div class="voter-item"><div><div class="voter-name">üî¨ Peer Researcher</div><div class="voter-role">Scientific Review</div></div><span class="vote-result pending">‚åõ Pending</span></div>
          </div>
          <div class="deadline-box">
            <div class="deadline-label">‚è± Voting Deadline</div>
            <div class="countdown" id="cd-1b">47:22:11</div>
            <div style="font-size:10.5px;color:#92400e;margin-top:3px;">2024-09-01 17:00 UTC</div>
          </div>
        </div>
        <div class="vote-action-panel">
          <div class="va-title">üó≥ Cast Your Vote</div>
          <div class="vote-options" id="opts-1">
            <label class="vote-option" onclick="selectVote(1,'approve',this)"><input type="radio" name="vote1" value="approve" /><span class="opt-icon">‚úÖ</span> Approve Access</label>
            <label class="vote-option" onclick="selectVote(1,'reject',this)"><input type="radio" name="vote1" value="reject" /><span class="opt-icon">‚ùå</span> Reject Request</label>
            <label class="vote-option" onclick="selectVote(1,'info',this)"><input type="radio" name="vote1" value="info" /><span class="opt-icon">üí¨</span> Request More Info</label>
          </div>
          <div class="comment-field"><label>Comments (recorded on blockchain)</label><textarea id="comment-1" placeholder="Add regulatory notes or conditions..."></textarea></div>
          <button class="submit-vote-btn" id="svb-1" onclick="submitVote(1)">Submit Vote ‚Üí</button>
          <div class="chain-mini">
            <div class="chain-mini-row"><span class="k">Network</span><span class="v">Hyperledger Fabric</span></div>
            <div class="chain-mini-row"><span class="k">Channel</span><span class="v">ch-VISIOR-gov</span></div>
            <div class="chain-mini-row"><span class="k">Block #</span><span class="v" id="bn-1">2,891,509</span></div>
            <div class="chain-mini-row"><span class="k">Vote TX</span><span class="v" id="tx-1">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- VOTE CARD 2 ‚Äî INSTITUTION MEMBERSHIP -->
    <div class="vote-card" id="card-2">
      <div class="vote-card-header">
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="vote-type-tag tag-membership">üèõ Institution Membership Application</span>
          <span class="vote-id">VOTE-ID: VT-2024-0904</span>
        </div>
        <div style="display:flex;align-items:center;gap:16px;">
          <div class="vote-deadline">‚è± Closes in <span class="countdown" id="cd-2">23:08:45</span></div>
          <span style="font-size:11px;color:var(--text3);">Submitted: 2024-09-02</span>
        </div>
      </div>
      <div class="vote-card-body">
        <div class="vote-info">
          <div class="applicant-row">
            <div class="applicant-avatar" style="background:linear-gradient(135deg,#fef3c7,#f5a623);">üè´</div>
            <div>
              <div class="applicant-name">Mayo Clinic Research Institute</div>
              <div class="applicant-meta">Rochester, Minnesota ¬∑ United States üá∫üá∏</div>
              <div class="applicant-meta">Type: Academic Medical Center ¬∑ Tier 1 Application</div>
            </div>
          </div>
          <div class="info-grid">
            <div class="info-item"><div class="lbl">Accreditation</div><div class="val">AAHRPP Certified</div></div>
            <div class="info-item"><div class="lbl">Application ID</div><div class="val mono">MBR-2024-0904</div></div>
            <div class="info-item"><div class="lbl">Proposed Role</div><div class="val">Consortium Data Provider</div></div>
            <div class="info-item"><div class="lbl">Active Trials</div><div class="val">14 trials eligible</div></div>
          </div>
          <div class="purpose-preview"><p>"Mayo Clinic Research Institute applies for VISIOR Tier 1 membership to contribute multi-site longitudinal cardiovascular and oncology datasets across 14 active IRB-approved trials..."</p></div>
          <button class="link-btn" onclick="window.location.href='proposal-view.html'">üìã View Application Details ‚Üí</button>
          <div class="inst-flags" style="margin-top:12px;">
            <span class="inst-flag">üîí HIPAA Compliant</span><span class="inst-flag">üè• JCI Accredited</span>
            <span class="inst-flag">üß¨ Genomics Capable</span><span class="inst-flag">üìä 14 Trials</span>
          </div>
          <div class="bias-section" style="margin-top:12px;">
            <div class="bias-title">ü§ñ Automated Compliance Check</div>
            <div class="bias-row"><span class="bias-label">Accreditation Valid</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:100%"></div></div><span class="bias-status pass">‚úì Verified</span></div>
            <div class="bias-row"><span class="bias-label">Data Security Score</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:96%"></div></div><span class="bias-status pass">‚úì Excellent (96%)</span></div>
            <div class="bias-row"><span class="bias-label">Prior Violations</span><div class="bias-bar-wrap"><div class="bias-bar high" style="width:100%"></div></div><span class="bias-status pass">‚úì None</span></div>
            <div class="bias-row"><span class="bias-label">Financial Disclosure</span><div class="bias-bar-wrap"><div class="bias-bar med" style="width:72%"></div></div><span class="bias-status warn">‚ö† Partial (72%)</span></div>
          </div>
        </div>
        <div class="vote-status-panel">
          <div class="vs-title">üìä Live Vote Status</div>
          <div class="vote-progress-wrap">
            <div class="vote-prog-label"><span>Votes Received</span><span id="vp2-count">1 of 5</span></div>
            <div class="vote-prog-track"><div class="vote-prog-fill" id="vp2-fill" style="width:20%"></div></div>
          </div>
          <div class="voter-list" id="voter-list-2">
            <div class="voter-item"><div><div class="voter-name">üèõÔ∏è FDA Regulator</div><div class="voter-role">Your Vote</div></div><span class="vote-result pending" id="my-vote-2">‚åõ Pending</span></div>
            <div class="voter-item"><div><div class="voter-name">üè¢ Consortium Lead</div><div class="voter-role">VISIOR Governance Board</div></div><span class="vote-result approved">‚úì Approved</span></div>
            <div class="voter-item"><div><div class="voter-name">‚öñÔ∏è Ethics Committee</div><div class="voter-role">Multi-Site IRB</div></div><span class="vote-result pending">‚åõ Pending</span></div>
            <div class="voter-item"><div><div class="voter-name">üîí Security Officer</div><div class="voter-role">VISIOR InfoSec</div></div><span class="vote-result pending">‚åõ Pending</span></div>
            <div class="voter-item"><div><div class="voter-name">üíº Legal Counsel</div><div class="voter-role">Regulatory Affairs</div></div><span class="vote-result pending">‚åõ Pending</span></div>
          </div>
          <div class="deadline-box">
            <div class="deadline-label">‚è± Voting Deadline</div>
            <div class="countdown" id="cd-2b">23:08:45</div>
            <div style="font-size:10.5px;color:#92400e;margin-top:3px;">2024-09-05 12:00 UTC</div>
          </div>
        </div>
        <div class="vote-action-panel">
          <div class="va-title">üó≥ Cast Your Vote</div>
          <div class="vote-options" id="opts-2">
            <label class="vote-option" onclick="selectVote(2,'approve',this)"><input type="radio" name="vote2" value="approve" /><span class="opt-icon">‚úÖ</span> Approve Membership</label>
            <label class="vote-option" onclick="selectVote(2,'reject',this)"><input type="radio" name="vote2" value="reject" /><span class="opt-icon">‚ùå</span> Reject Application</label>
            <label class="vote-option" onclick="selectVote(2,'conditional',this)"><input type="radio" name="vote2" value="conditional" /><span class="opt-icon">üìã</span> Conditional Approval</label>
            <label class="vote-option" onclick="selectVote(2,'info',this)"><input type="radio" name="vote2" value="info" /><span class="opt-icon">üí¨</span> Request More Info</label>
          </div>
          <div class="comment-field"><label>Comments (recorded on blockchain)</label><textarea id="comment-2" placeholder="Add conditions, regulatory notes, or requirements..."></textarea></div>
          <button class="submit-vote-btn" id="svb-2" onclick="submitVote(2)">Submit Vote ‚Üí</button>
          <div class="chain-mini">
            <div class="chain-mini-row"><span class="k">Network</span><span class="v">Hyperledger Fabric</span></div>
            <div class="chain-mini-row"><span class="k">Channel</span><span class="v">ch-VISIOR-gov</span></div>
            <div class="chain-mini-row"><span class="k">Block #</span><span class="v" id="bn-2">2,891,509</span></div>
            <div class="chain-mini-row"><span class="k">Vote TX</span><span class="v" id="tx-2">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

  </div>
  
  <!-- Footer Links -->
  <div class="footer-links">
    <a href="help.html">Help</a>
    <a href="privacy.html">Privacy</a>
    <a href="terms.html">Terms</a>
    <a href="contact.html">Contact</a>
  </div>
</div>

<!-- VOTE CONFIRM MODAL -->
<div id="modal-overlay">
  <div class="modal">
    <h2 id="modal-title">‚úÖ Vote Submitted Successfully</h2>
    <p id="modal-desc">Your vote has been hashed and immutably recorded on the Hyperledger Fabric blockchain. This vote cannot be modified or retracted.</p>
    <div class="modal-hash" id="modal-hash">‚Äî</div>
    <div class="modal-row"><span class="k">Vote ID</span><span class="v" id="m-vote-id">‚Äî</span></div>
    <div class="modal-row"><span class="k">Decision</span><span class="v" id="m-decision">‚Äî</span></div>
    <div class="modal-row"><span class="k">Blockchain TX</span><span class="v" id="m-tx">‚Äî</span></div>
    <div class="modal-row"><span class="k">Block Number</span><span class="v" id="m-block">‚Äî</span></div>
    <div class="modal-row"><span class="k">Channel</span><span class="v">ch-VISIOR-gov</span></div>
    <div class="modal-row"><span class="k">Timestamp</span><span class="v" id="m-ts">‚Äî</span></div>
    <div class="modal-row"><span class="k">Voter</span><span class="v">FDA Regulatory Admin</span></div>
    <div class="modal-btns">
      <button class="btn btn-outline" onclick="closeModal()">Close</button>
      <button class="btn btn-primary" onclick="closeModal()">Continue Reviewing</button>
    </div>
  </div>
</div>

<!-- PROPOSAL MODAL -->
<div id="proposal-modal">
  <div class="proposal-modal-box">
    <h2 id="pm-title">Full Research Proposal</h2>
    <div id="pm-body"></div>
    <div style="display:flex;justify-content:flex-end;margin-top:18px;">
      <button class="btn btn-outline" onclick="document.getElementById('proposal-modal').classList.remove('show')">Close</button>
    </div>
  </div>
</div>

<div id="toast-wrap"></div>

<script>
function toggleProfile() {
  window.location.href = 'profile.html';
}

function rh(n){ return [...Array(n)].map(()=>Math.floor(Math.random()*16).toString(16)).join(''); }
function genTx(){ return '0x'+rh(40); }
function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }
const voteState = { 1: null, 2: null };

function toast2(title, sub='', type='success'){
  const w=document.getElementById('toast-wrap');
  const t=document.createElement('div'); t.className='toast '+type;
  t.innerHTML=`<div class="toast-title">${title}</div>${sub?`<div class="toast-sub">${sub}</div>`:''}`;
  w.appendChild(t); setTimeout(()=>t.remove(),3800);
}

function confirmLogout(){
  if(confirm('Log out of VISIOR Governance Portal?\nThis session will be recorded on blockchain.')){
    const tx=genTx(); toast2('Session terminated ¬∑ Logged on blockchain',tx);
    setTimeout(()=>{ window.location.href='login.html'; },1400);
  }
}

function selectVote(cardId,decision,el){
  document.getElementById('opts-'+cardId).querySelectorAll('.vote-option').forEach(o=>o.className='vote-option');
  const cls=decision==='approve'?'selected-approve':decision==='reject'?'selected-reject':decision==='info'?'selected-info':'selected-conditional';
  el.className='vote-option '+cls;
  voteState[cardId]=decision;
}

async function submitVote(cardId){
  if(!voteState[cardId]){ toast2('Please select a vote option before submitting','','error'); return; }
  const btn=document.getElementById('svb-'+cardId);
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span> Hashing vote‚Ä¶';
  toast2('Generating vote hash‚Ä¶','','info'); await delay(600);
  toast2('Signing with regulatory key‚Ä¶','','info'); await delay(700);
  toast2('Logging to Hyperledger Fabric‚Ä¶','','info'); await delay(800);
  const tx=genTx();
  const voteId='VT-2024-0'+Math.floor(800+Math.random()*100);
  const bh=parseInt(document.getElementById('s-block').textContent.replace(/,/g,''))+Math.floor(1+Math.random()*3);
  document.getElementById('s-block').textContent=bh.toLocaleString();
  document.getElementById('bn-'+cardId).textContent=bh.toLocaleString();
  document.getElementById('tx-'+cardId).textContent=tx.substring(0,16)+'‚Ä¶';
  const myVoteEl=document.getElementById('my-vote-'+cardId);
  const decisionMap={approve:'‚úì Approved',reject:'‚úó Rejected',info:'? More Info',conditional:'üìã Conditional'};
  const decisionClass={approve:'approved',reject:'rejected',info:'abstain',conditional:'abstain'};
  myVoteEl.textContent=decisionMap[voteState[cardId]]; myVoteEl.className='vote-result '+decisionClass[voteState[cardId]];
  const newCount=cardId===1?3:2;
  document.getElementById('vp'+cardId+'-count').textContent=newCount+' of 5';
  document.getElementById('vp'+cardId+'-fill').style.width=(newCount/5*100)+'%';
  document.getElementById('s-cast').textContent=parseInt(document.getElementById('s-cast').textContent)+1;
  const sp=Math.max(0,parseInt(document.getElementById('s-pending').textContent)-1);
  document.getElementById('s-pending').textContent=sp; document.getElementById('pending-badge').textContent=sp;
  if(voteState[cardId]==='approve') document.getElementById('s-approved').textContent=parseInt(document.getElementById('s-approved').textContent)+1;
  document.getElementById('card-'+cardId).classList.add('voted');
  btn.innerHTML='‚úì Vote Recorded'; btn.className='submit-vote-btn voted-state';
  document.getElementById('modal-title').textContent='‚úÖ Vote Submitted & Logged on Blockchain';
  document.getElementById('modal-hash').textContent=tx;
  document.getElementById('m-vote-id').textContent=voteId;
  document.getElementById('m-decision').textContent=decisionMap[voteState[cardId]];
  document.getElementById('m-tx').textContent=tx.substring(0,22)+'‚Ä¶';
  document.getElementById('m-block').textContent=bh.toLocaleString();
  document.getElementById('m-ts').textContent=new Date().toISOString();
  document.getElementById('modal-overlay').classList.add('show');
  toast2('Vote recorded on blockchain ‚õì',tx,'success');
}

function closeModal(){ document.getElementById('modal-overlay').classList.remove('show'); }

const proposals = {
  card1: { title:'Full Research Proposal ‚Äî Dr. Sarah Smith', body:`<div class="prop-section"><h4>Research Title</h4><p>Multi-Site Cardiovascular Risk Stratification Using Federated Machine Learning on Longitudinal Patient Cohorts</p></div><div class="prop-section"><h4>Detailed Description</h4><p>This study aims to develop and validate a federated machine learning model for cardiovascular risk stratification across multiple hospital sites. By leveraging anonymized longitudinal patient data from the CARDIO-PRECISION-II trial, the research seeks to improve early detection of major adverse cardiovascular events (MACE) by an estimated 23%.</p></div><div class="prop-section"><h4>Methodology</h4><p>Phase 1: Data harmonization (months 1-3). Phase 2: Federated model training (months 4-8). Phase 3: Validation and bias assessment (months 9-12). Phase 4: Publication (months 13-14).</p></div><div class="prop-section"><h4>Ethics Approval</h4><p>IRB-JHU-2024-0312 ¬∑ Approved: 2024-03-12 ¬∑ Expires: 2025-03-12 ¬∑ Full board approval.</p></div>` },
  card2: { title:'Membership Application ‚Äî Mayo Clinic Research Institute', body:`<div class="prop-section"><h4>Institution Overview</h4><p>Mayo Clinic Research Institute is a globally recognized academic medical center with 14 active IRB-approved clinical trials eligible for VISIOR data contribution.</p></div><div class="prop-section"><h4>Proposed Tier</h4><p>Tier 1 ‚Äî Consortium Data Provider.</p></div><div class="prop-section"><h4>Accreditations</h4><p>AAHRPP Certified ¬∑ JCI Accredited ¬∑ SOC 2 Type II ¬∑ HITRUST CSF Certified ¬∑ Full HIPAA, HITECH, and GDPR compliance.</p></div><div class="prop-section"><h4>Financial Disclosure</h4><p>Partial disclosure pending for 3 investigator-initiated trials ‚Äî full documentation within 30 days if conditionally approved.</p></div>` }
};
function openProposal(key){
  const p=proposals[key];
  document.getElementById('pm-title').textContent=p.title;
  document.getElementById('pm-body').innerHTML=p.body;
  document.getElementById('proposal-modal').classList.add('show');
}

function startCountdown(id,hours,mins,secs){
  let total=hours*3600+mins*60+secs;
  const targets=document.querySelectorAll('#cd-'+id+', #cd-'+id+'b');
  const tick=()=>{
    if(total<=0){ targets.forEach(t=>t.textContent='EXPIRED'); return; }
    const h=String(Math.floor(total/3600)).padStart(2,'0');
    const m=String(Math.floor((total%3600)/60)).padStart(2,'0');
    const s=String(total%60).padStart(2,'0');
    targets.forEach(t=>t.textContent=`${h}:${m}:${s}`);
    total--;
  };
  tick(); setInterval(tick,1000);
}
startCountdown(1,47,22,11);
startCountdown(2,23,8,45);

setInterval(()=>{
  const el=document.getElementById('s-block');
  if(el){ const n=parseInt(el.textContent.replace(/,/g,''))+1; el.textContent=n.toLocaleString(); }
  [1,2].forEach(i=>{ const bn=document.getElementById('bn-'+i); if(bn) bn.textContent=document.getElementById('s-block').textContent; });
},10000);

setTimeout(()=>{
  const pa=document.querySelector('#voter-list-1 .voter-item:nth-child(4) .vote-result');
  if(pa){ pa.textContent='‚úì Approved'; pa.className='vote-result approved'; }
  document.getElementById('vp1-count').textContent='3 of 5';
  document.getElementById('vp1-fill').style.width='60%';
  toast2('üó≥ Patient Advocate voted on VT-2024-0831',genTx(),'info');
},12000);

setTimeout(()=>{
  const so=document.querySelector('#voter-list-2 .voter-item:nth-child(4) .vote-result');
  if(so){ so.textContent='‚úì Approved'; so.className='vote-result approved'; }
  document.getElementById('vp2-count').textContent='2 of 5';
  document.getElementById('vp2-fill').style.width='40%';
  toast2('üó≥ Security Officer voted on VT-2024-0904',genTx(),'info');
},20000);
</script>
</body>
</html>