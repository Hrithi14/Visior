<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WISER ‚Äì PI Dashboard | My Trials</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #4567B7;
    --primary-dark: #334e96;
    --primary-light: #eef1f9;
    --primary-mid: #d0d9f0;
    --accent: #2ecc8f;
    --accent-warn: #f59e0b;
    --accent-danger: #ef4444;
    --accent-info: #06b6d4;
    --bg: #f7f8fc;
    --card: #ffffff;
    --border: #e2e6f0;
    --text: #1a2035;
    --text-secondary: #5a6480;
    --text-light: #8b94b0;
    --shadow-sm: 0 1px 3px rgba(69,103,183,0.08), 0 1px 2px rgba(0,0,0,0.04);
    --shadow: 0 4px 16px rgba(69,103,183,0.10), 0 1px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 8px 32px rgba(69,103,183,0.14), 0 2px 8px rgba(0,0,0,0.06);
    --radius: 12px;
    --radius-sm: 8px;
    --radius-xs: 6px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 14px;
    line-height: 1.5;
  }

  .header {
    background: var(--card);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow-sm);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    cursor: pointer;
  }

  .logo-icon {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(69,103,183,0.3);
  }

  .logo-text {
    display: flex;
    flex-direction: column;
    line-height: 1.1;
  }

  .logo-text strong {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    letter-spacing: 0.04em;
  }

  .logo-text span {
    font-size: 9.5px;
    color: var(--text-light);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    font-weight: 500;
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .chain-status {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    background: #f0fdf4;
    border: 1px solid #bbf7d0;
    border-radius: 20px;
    font-size: 12px;
    color: #16a34a;
    font-weight: 500;
    font-family: 'DM Mono', monospace;
  }

  .chain-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: #22c55e;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34,197,94,0.4); }
    50% { opacity: 0.8; box-shadow: 0 0 0 5px rgba(34,197,94,0); }
  }

  .profile-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px 6px 8px;
    background: var(--primary-light);
    border: 1px solid var(--primary-mid);
    border-radius: 24px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
    color: var(--primary-dark);
    font-size: 13px;
    font-family: 'DM Sans', sans-serif;
  }

  .profile-btn:hover { background: var(--primary-mid); }

  .profile-avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    flex-shrink: 0;
  }

  .subnav {
    background: var(--card);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    display: flex;
    align-items: center;
    gap: 4px;
    height: 48px;
  }

  .subnav-link {
    padding: 6px 14px;
    border-radius: var(--radius-xs);
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.18s;
    cursor: pointer;
  }

  .subnav-link:hover { background: var(--bg); color: var(--text); }

  .subnav-link.active {
    background: var(--primary-light);
    color: var(--primary);
    font-weight: 600;
  }

  .subnav-sep { margin-left: auto; }

  .main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 28px 32px;
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 24px;
  }

  .user-banner {
    grid-column: 1 / -1;
    background: linear-gradient(135deg, var(--primary) 0%, #334e96 100%);
    border-radius: var(--radius);
    padding: 24px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .user-banner::before {
    content: '';
    position: absolute;
    top: -40px;
    right: 60px;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: rgba(255,255,255,0.05);
  }

  .user-banner::after {
    content: '';
    position: absolute;
    bottom: -60px;
    right: 20px;
    width: 240px;
    height: 240px;
    border-radius: 50%;
    background: rgba(255,255,255,0.04);
  }

  .user-info { display: flex; align-items: center; gap: 18px; }

  .user-avatar-lg {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
  }

  .user-info h1 { font-size: 20px; font-weight: 700; color: white; }
  .user-info p { font-size: 13px; color: rgba(255,255,255,0.75); margin-top: 3px; }

  .user-meta {
    display: flex;
    gap: 12px;
    margin-top: 10px;
    flex-wrap: wrap;
  }

  .user-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 11.5px;
    font-weight: 600;
    letter-spacing: 0.02em;
  }

  .user-badge.tier { background: rgba(255,255,255,0.2); color: white; }
  .user-badge.role { background: rgba(46,204,143,0.25); color: #6ee7b7; }
  .user-badge.inst { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); }

  .banner-stats {
    display: flex;
    gap: 24px;
    position: relative;
    z-index: 1;
  }

  .bstat {
    text-align: center;
    padding: 12px 20px;
    background: rgba(255,255,255,0.1);
    border-radius: var(--radius-sm);
    border: 1px solid rgba(255,255,255,0.15);
    min-width: 90px;
  }

  .bstat-value { font-size: 24px; font-weight: 700; color: white; }
  .bstat-label { font-size: 11px; color: rgba(255,255,255,0.65); margin-top: 3px; text-transform: uppercase; letter-spacing: 0.05em; }

  .section-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .section-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .section-title::before {
    content: '';
    width: 4px;
    height: 16px;
    background: var(--primary);
    border-radius: 2px;
    display: block;
  }

  .badge-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 22px;
    height: 20px;
    padding: 0 6px;
    border-radius: 10px;
    background: var(--primary);
    color: white;
    font-size: 11px;
    font-weight: 700;
  }

  .trial-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 16px;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: box-shadow 0.2s, transform 0.2s;
    animation: fadeUp 0.4s ease both;
    cursor: pointer;
  }

  .trial-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }

  .trial-card-header {
    padding: 18px 20px 14px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
  }

  .trial-meta-top { flex: 1; }

  .trial-name {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
    line-height: 1.3;
  }

  .trial-id-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .trial-id {
    font-family: 'DM Mono', monospace;
    font-size: 11.5px;
    color: var(--primary);
    background: var(--primary-light);
    padding: 2px 7px;
    border-radius: 4px;
  }

  .trial-date { font-size: 12px; color: var(--text-light); }

  .status-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px;
    border-radius: 20px;
    font-size: 11.5px;
    font-weight: 600;
    flex-shrink: 0;
    white-space: nowrap;
  }

  .status-pill::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
    display: block;
  }

  .status-active { background: #f0fdf4; color: #16a34a; }
  .status-recruiting { background: #eff6ff; color: var(--primary); }
  .status-completed { background: #f8fafc; color: #64748b; }

  .trial-card-body {
    padding: 14px 20px;
    display: flex;
    align-items: center;
    gap: 24px;
    flex-wrap: wrap;
  }

  .trial-stat { display: flex; flex-direction: column; gap: 2px; }
  .trial-stat-val { font-size: 18px; font-weight: 700; color: var(--text); }
  .trial-stat-lbl { font-size: 11px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em; }
  .trial-stat-sep { width: 1px; height: 36px; background: var(--border); }

  .enrollment-bar-wrap { flex: 1; min-width: 160px; }
  .enrollment-bar-top { display: flex; justify-content: space-between; margin-bottom: 5px; }
  .enrollment-bar-top span { font-size: 11.5px; color: var(--text-secondary); }
  .enrollment-bar-top strong { font-size: 11.5px; color: var(--text); }

  .enrollment-bar {
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }

  .enrollment-fill {
    height: 100%;
    border-radius: 3px;
    background: linear-gradient(90deg, var(--primary) 0%, #6b8de0 100%);
    transition: width 1s ease;
  }

  .trial-card-actions {
    padding: 14px 20px;
    background: var(--bg);
    border-top: 1px solid var(--border);
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: var(--radius-xs);
    font-size: 12.5px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: all 0.18s;
    font-family: 'DM Sans', sans-serif;
    text-decoration: none;
    white-space: nowrap;
  }

  .btn:disabled { opacity: 0.6; cursor: not-allowed; }

  .btn-primary { background: var(--primary); color: white; box-shadow: 0 2px 6px rgba(69,103,183,0.3); }
  .btn-primary:hover:not(:disabled) { background: var(--primary-dark); }

  .btn-ghost { background: white; color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover:not(:disabled) { border-color: var(--primary); color: var(--primary); background: var(--primary-light); }

  .btn-danger { background: #fff5f5; color: var(--accent-danger); border: 1px solid #fecaca; }
  .btn-danger:hover:not(:disabled) { background: #fef2f2; border-color: var(--accent-danger); }

  .btn-warn { background: #fffbeb; color: #d97706; border: 1px solid #fde68a; }
  .btn-warn:hover:not(:disabled) { background: #fef3c7; }

  .spinner {
    display: none;
    width: 12px;
    height: 12px;
    border: 2px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .sidebar { display: flex; flex-direction: column; gap: 20px; }

  .panel {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }

  .panel-head {
    padding: 14px 18px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bg);
  }

  .panel-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 7px;
  }

  .panel-body { padding: 4px 0; }

  .pending-item {
    padding: 12px 18px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-start;
    gap: 10px;
    transition: background 0.15s;
    cursor: pointer;
  }

  .pending-item:last-child { border-bottom: none; }
  .pending-item:hover { background: var(--bg); }

  .pending-icon {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 14px;
  }

  .pi-access { background: #eff6ff; }
  .pi-data { background: #fefce8; }
  .pi-audit { background: #f0fdf4; }
  .pi-sae { background: #fff5f5; }

  .pending-content { flex: 1; }
  .pending-trial { font-size: 11px; color: var(--text-light); margin-bottom: 2px; }
  .pending-desc { font-size: 12.5px; font-weight: 600; color: var(--text); }
  .pending-time { font-size: 11px; color: var(--text-light); margin-top: 2px; }

  .pending-badge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .pb-red { background: #fee2e2; color: #dc2626; }
  .pb-blue { background: var(--primary-light); color: var(--primary); }
  .pb-amber { background: #fef3c7; color: #d97706; }
  .pb-green { background: #f0fdf4; color: #16a34a; }

  .chain-feed { max-height: 280px; overflow-y: auto; }

  .chain-feed::-webkit-scrollbar { width: 4px; }
  .chain-feed::-webkit-scrollbar-track { background: transparent; }
  .chain-feed::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .chain-entry {
    padding: 10px 18px;
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  .chain-entry:last-child { border-bottom: none; }
  .chain-entry:hover { background: var(--bg); }
  .chain-entry-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px; }
  .chain-action { font-size: 12px; font-weight: 600; color: var(--text); }
  .chain-time { font-size: 11px; color: var(--text-light); }

  .chain-hash {
    font-family: 'DM Mono', monospace;
    font-size: 10.5px;
    color: var(--primary);
    background: var(--primary-light);
    padding: 2px 6px;
    border-radius: 4px;
    word-break: break-all;
  }

  .chain-block { font-size: 10.5px; color: var(--text-light); margin-top: 3px; }

  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 360px;
  }

  .toast {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 14px 16px;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: flex-start;
    gap: 12px;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .toast-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
  .toast-title { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
  .toast-msg { font-size: 12px; color: var(--text-secondary); }
  .toast-hash { font-family: 'DM Mono', monospace; font-size: 10.5px; color: var(--primary); margin-top: 4px; }

  .rt-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    color: #16a34a;
    font-weight: 500;
  }

  .rt-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #22c55e;
    animation: pulse 2s infinite;
  }

  .sae-banner {
    margin-bottom: 16px;
    background: #fff5f5;
    border: 1px solid #fecaca;
    border-left: 4px solid var(--accent-danger);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    animation: fadeUp 0.3s ease;
  }

  .sae-left { display: flex; align-items: center; gap: 10px; }
  .sae-icon { font-size: 18px; }
  .sae-title { font-size: 13px; font-weight: 700; color: #dc2626; }
  .sae-sub { font-size: 12px; color: #ef4444; margin-top: 1px; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .footer-links {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 20px;
    padding: 20px 0;
    border-top: 1px solid var(--border);
  }

  .footer-links a {
    color: var(--text-light);
    text-decoration: none;
    font-size: 12px;
    transition: color 0.2s;
  }

  .footer-links a:hover {
    color: var(--primary);
  }

  @media (max-width: 1024px) {
    .main { grid-template-columns: 1fr; }
    .sidebar { grid-row: 2; }
  }

  @media (max-width: 640px) {
    .main { padding: 16px; }
    .header { padding: 0 16px; }
    .subnav { padding: 0 16px; overflow-x: auto; }
    .banner-stats { display: none; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="logo" onclick="window.location.href='home.html'">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
        <path d="M12 2L4 6v6c0 5.25 3.5 10.15 8 11.5C16.5 22.15 20 17.25 20 12V6L12 2z"/>
        <path d="M9 12l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="logo-text">
      <strong>WISER</strong>
      <span>Verified Intelligent Secure Evidence Registry</span>
    </div>
  </div>
  <div class="header-right">
    <div class="chain-status">
      <div class="chain-dot"></div>
      <span>Hyperledger Fabric ¬∑ Block #148,204</span>
    </div>
    <button class="profile-btn" onclick="toggleProfileMenu()">
      <div class="profile-avatar">SS</div>
      Dr. Sarah Smith
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
    </button>
  </div>
</header>

<!-- SECONDARY NAV -->
<nav class="subnav">
  <a class="subnav-link active" href="#" onclick="window.location.href='pi-dashboard.html'">My Trials</a>
  <a class="subnav-link" href="#" onclick="window.location.href='full-data.html?trial=WISER-2024-003'">Upload Data</a>
  <a class="subnav-link" href="#" onclick="window.location.href='voting.html'">Access Requests</a>
  <a class="subnav-link" href="#" onclick="window.location.href='audit-log.html'">Audit</a>
  <a class="subnav-link" href="#" onclick="window.location.href='profile.html'">Profile</a>
  <div class="subnav-sep"></div>
  <a class="subnav-link" href="#" onclick="handleLogout(event)" style="color:#ef4444;">Logout</a>
</nav>

<!-- MAIN -->
<div class="main">

  <!-- USER BANNER -->
  <div class="user-banner">
    <div class="user-info">
      <div class="user-avatar-lg">SS</div>
      <div>
        <h1>Welcome back, Dr. Sarah Smith</h1>
        <p>Massachusetts General Hospital ¬∑ Harvard Medical School</p>
        <div class="user-meta">
          <span class="user-badge role">Principal Investigator</span>
          <span class="user-badge tier">‚≠ê Tier 3 ‚Äì Full Access</span>
          <span class="user-badge inst">WISER ID: PI-2024-0047</span>
        </div>
      </div>
    </div>
    <div class="banner-stats">
      <div class="bstat">
        <div class="bstat-value">5</div>
        <div class="bstat-label">Total Trials</div>
      </div>
      <div class="bstat">
        <div class="bstat-value" id="total-patients">1,284</div>
        <div class="bstat-label">Patients Enrolled</div>
      </div>
      <div class="bstat">
        <div class="bstat-value" style="color:#fbbf24;">8</div>
        <div class="bstat-label">Pending Actions</div>
      </div>
      <div class="bstat">
        <div class="bstat-value" style="color:#6ee7b7;" id="chain-txs">247</div>
        <div class="bstat-label">Chain Txns</div>
      </div>
    </div>
  </div>

  <!-- LEFT COLUMN -->
  <div>

    <!-- SAE Alert Banner -->
    <div class="sae-banner">
      <div class="sae-left">
        <div class="sae-icon">üö®</div>
        <div>
          <div class="sae-title">Serious Adverse Event Alert</div>
          <div class="sae-sub">WISER-2024-003 ¬∑ CARDIOPROTECT-II ¬∑ Grade 3 Cardiac Event ‚Äì Patient P0482 ¬∑ Received 2 hours ago</div>
        </div>
      </div>
      <button class="btn btn-danger" onclick="handleAction('report-sae','WISER-2024-003', this)">
        <span class="spinner"></span>
        Report SAE
      </button>
    </div>

    <!-- TRIALS HEADING -->
    <div class="section-head">
      <div class="section-title">Your Trials <span class="badge-count">5</span></div>
      <span class="rt-badge"><span class="rt-dot"></span> Live updates</span>
    </div>

    <!-- TRIAL CARD 1 ‚Äì ACTIVE -->
    <div class="trial-card" onclick="window.location.href='full-data.html?trial=WISER-2024-003'">
      <div class="trial-card-header">
        <div class="trial-meta-top">
          <div class="trial-name">CARDIOPROTECT-II: Cardioprotective Effects of Novel ACE Inhibitor in Post-MI Patients</div>
          <div class="trial-id-row">
            <span class="trial-id">WISER-2024-003</span>
            <span class="trial-date">Posted 14 Mar 2024</span>
          </div>
        </div>
        <span class="status-pill status-active">Active</span>
      </div>
      <div class="trial-card-body">
        <div class="trial-stat">
          <div class="trial-stat-val" id="cp2-enrolled">342</div>
          <div class="trial-stat-lbl">Enrolled</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val">500</div>
          <div class="trial-stat-lbl">Target</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val" style="color:#ef4444;" id="cp2-sae">3</div>
          <div class="trial-stat-lbl">SAE Events</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="enrollment-bar-wrap">
          <div class="enrollment-bar-top">
            <span>Enrollment Progress</span>
            <strong id="cp2-pct">68.4%</strong>
          </div>
          <div class="enrollment-bar">
            <div class="enrollment-fill" id="cp2-bar" style="width:68.4%"></div>
          </div>
        </div>
      </div>
      <div class="trial-card-actions" onclick="event.stopPropagation()">
        <button class="btn btn-primary" onclick="window.location.href='full-data.html?trial=WISER-2024-003'">
          <span class="spinner"></span>‚öôÔ∏è Manage Trial
        </button>
        <button class="btn btn-ghost" onclick="window.location.href='full-data.html?trial=WISER-2024-003'">
          <span class="spinner"></span>‚ûï Add Patient Data
        </button>
        <button class="btn btn-danger" onclick="handleAction('report-sae','WISER-2024-003', this)">
          <span class="spinner"></span>üö® Report SAE
        </button>
        <button class="btn btn-ghost" onclick="handleAction('progress','WISER-2024-003', this)">
          <span class="spinner"></span>üìä View Progress
        </button>
      </div>
    </div>

    <!-- TRIAL CARD 2 ‚Äì RECRUITING -->
    <div class="trial-card" onclick="window.location.href='full-data.html?trial=WISER-2024-011'">
      <div class="trial-card-header">
        <div class="trial-meta-top">
          <div class="trial-name">NEURO-RESTORE: Neuroprotective Intervention in Early-Stage Parkinson's Disease</div>
          <div class="trial-id-row">
            <span class="trial-id">WISER-2024-011</span>
            <span class="trial-date">Posted 2 Jul 2024</span>
          </div>
        </div>
        <span class="status-pill status-recruiting">Recruiting</span>
      </div>
      <div class="trial-card-body">
        <div class="trial-stat">
          <div class="trial-stat-val" id="nr-enrolled">87</div>
          <div class="trial-stat-lbl">Enrolled</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val">300</div>
          <div class="trial-stat-lbl">Target</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val" style="color:#ef4444;">0</div>
          <div class="trial-stat-lbl">SAE Events</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="enrollment-bar-wrap">
          <div class="enrollment-bar-top">
            <span>Enrollment Progress</span>
            <strong id="nr-pct">29.0%</strong>
          </div>
          <div class="enrollment-bar">
            <div class="enrollment-fill" id="nr-bar" style="width:29%"></div>
          </div>
        </div>
      </div>
      <div class="trial-card-actions" onclick="event.stopPropagation()">
        <button class="btn btn-primary" onclick="window.location.href='full-data.html?trial=WISER-2024-011'">‚öôÔ∏è Manage Trial</button>
        <button class="btn btn-ghost" onclick="window.location.href='full-data.html?trial=WISER-2024-011'">‚ûï Add Patient Data</button>
        <button class="btn btn-danger" onclick="handleAction('report-sae','WISER-2024-011', this)">üö® Report SAE</button>
        <button class="btn btn-ghost" onclick="handleAction('progress','WISER-2024-011', this)">üìä View Progress</button>
      </div>
    </div>

    <!-- TRIAL CARD 3 ‚Äì COMPLETED -->
    <div class="trial-card" onclick="window.location.href='full-data.html?trial=WISER-2022-044'">
      <div class="trial-card-header">
        <div class="trial-meta-top">
          <div class="trial-name">DIABETIX-I: Glycemic Control via Incretin-Based Therapy in Type 2 Diabetes</div>
          <div class="trial-id-row">
            <span class="trial-id">WISER-2022-044</span>
            <span class="trial-date">Posted 10 Jan 2022</span>
          </div>
        </div>
        <span class="status-pill status-completed">Completed</span>
      </div>
      <div class="trial-card-body">
        <div class="trial-stat">
          <div class="trial-stat-val">450</div>
          <div class="trial-stat-lbl">Enrolled</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val">450</div>
          <div class="trial-stat-lbl">Target</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="trial-stat">
          <div class="trial-stat-val" style="color:#ef4444;">2</div>
          <div class="trial-stat-lbl">SAE Events</div>
        </div>
        <div class="trial-stat-sep"></div>
        <div class="enrollment-bar-wrap">
          <div class="enrollment-bar-top">
            <span>Enrollment Progress</span>
            <strong>100%</strong>
          </div>
          <div class="enrollment-bar">
            <div class="enrollment-fill" style="width:100%; background:linear-gradient(90deg,#64748b,#94a3b8)"></div>
          </div>
        </div>
      </div>
      <div class="trial-card-actions" onclick="event.stopPropagation()">
        <button class="btn btn-primary" onclick="window.location.href='full-data.html?trial=WISER-2022-044'">‚öôÔ∏è Manage Trial</button>
        <button class="btn btn-ghost" onclick="window.location.href='full-data.html?trial=WISER-2022-044'">üìÇ View Full Data</button>
        <button class="btn btn-warn" onclick="window.location.href='voting.html'">üìã Review Requests</button>
        <button class="btn btn-ghost" onclick="handleAction('audit-log','WISER-2022-044', this)">üîç Audit Log</button>
      </div>
    </div>

  </div><!-- /left column -->

  <!-- RIGHT SIDEBAR -->
  <div class="sidebar">

    <!-- PENDING ACTIONS -->
    <div class="panel">
      <div class="panel-head">
        <span class="panel-title">‚ö†Ô∏è Pending Actions <span class="badge-count" style="background:#ef4444;">8</span></span>
        <span class="rt-badge"><span class="rt-dot"></span></span>
      </div>
      <div class="panel-body">

        <div class="pending-item" onclick="window.location.href='full-data.html?trial=WISER-2024-003&alert=sae'">
          <div class="pending-icon pi-sae">üö®</div>
          <div class="pending-content">
            <div class="pending-trial">WISER-2024-003</div>
            <div class="pending-desc">SAE Alert ‚Äì Grade 3 Cardiac Event</div>
            <div class="pending-time">2 hours ago ¬∑ Immediate action required</div>
          </div>
          <span class="pending-badge pb-red">URGENT</span>
        </div>

        <div class="pending-item" onclick="window.location.href='voting.html'">
          <div class="pending-icon pi-access">üì©</div>
          <div class="pending-content">
            <div class="pending-trial">WISER-2022-044</div>
            <div class="pending-desc">4 New Access Requests</div>
            <div class="pending-time">From 4 institutions ¬∑ Pending review</div>
          </div>
          <span class="pending-badge pb-blue">4 NEW</span>
        </div>

        <div class="pending-item" onclick="window.location.href='voting.html'">
          <div class="pending-icon pi-access">üì©</div>
          <div class="pending-content">
            <div class="pending-trial">WISER-2021-018</div>
            <div class="pending-desc">2 New Access Requests</div>
            <div class="pending-time">From NIH, Stanford ¬∑ Pending review</div>
          </div>
          <span class="pending-badge pb-blue">2 NEW</span>
        </div>

        <div class="pending-item" onclick="window.location.href='full-data.html?trial=WISER-2024-003&correction'">
          <div class="pending-icon pi-data">‚úèÔ∏è</div>
          <div class="pending-content">
            <div class="pending-trial">WISER-2024-003</div>
            <div class="pending-desc">1 Data Correction Request</div>
            <div class="pending-time">Patient P0321 ¬∑ Lab values amendment</div>
          </div>
          <span class="pending-badge pb-amber">REVIEW</span>
        </div>

        <div class="pending-item" onclick="window.location.href='voting.html'">
          <div class="pending-icon pi-audit">üîç</div>
          <div class="pending-content">
            <div class="pending-trial">WISER-2024-011</div>
            <div class="pending-desc">Audit Deadline in 7 Days</div>
            <div class="pending-time">FDA Compliance Review ¬∑ 15 Nov 2024</div>
          </div>
          <span class="pending-badge pb-amber">7 DAYS</span>
        </div>

      </div>
    </div>

    <!-- BLOCKCHAIN LOG -->
    <div class="panel">
      <div class="panel-head">
        <span class="panel-title">‚õì Blockchain Log</span>
        <span style="font-size:11px;color:var(--text-light);font-family:'DM Mono',monospace;">Hyperledger Fabric</span>
      </div>
      <div class="panel-body chain-feed" id="chain-feed">

        <div class="chain-entry">
          <div class="chain-entry-top">
            <span class="chain-action">Patient Data Added</span>
            <span class="chain-time">09:42 AM</span>
          </div>
          <div class="chain-hash">0x3fa8b2c1d9e7...4a2c</div>
          <div class="chain-block">Block #148,204 ¬∑ WISER-2024-003</div>
        </div>

        <div class="chain-entry">
          <div class="chain-entry-top">
            <span class="chain-action">Access Request Reviewed</span>
            <span class="chain-time">Yesterday</span>
          </div>
          <div class="chain-hash">0x9c21a8f3e47b...8d01</div>
          <div class="chain-block">Block #148,117 ¬∑ WISER-2022-044</div>
        </div>

        <div class="chain-entry">
          <div class="chain-entry-top">
            <span class="chain-action">Trial Metadata Updated</span>
            <span class="chain-time">2 days ago</span>
          </div>
          <div class="chain-hash">0x6b4e7d2af180...c39f</div>
          <div class="chain-block">Block #147,990 ¬∑ WISER-2024-011</div>
        </div>

        <div class="chain-entry">
          <div class="chain-entry-top">
            <span class="chain-action">SAE Reported</span>
            <span class="chain-time">3 days ago</span>
          </div>
          <div class="chain-hash">0x1d3c9a72f554...ab7e</div>
          <div class="chain-block">Block #147,843 ¬∑ WISER-2023-029</div>
        </div>

      </div>
    </div>

    <!-- LIVE ENROLLMENT -->
    <div class="panel">
      <div class="panel-head">
        <span class="panel-title">üìà Live Enrollment</span>
        <span class="rt-badge"><span class="rt-dot"></span> Live</span>
      </div>
      <div class="panel-body">
        <div style="padding:14px 18px; display:flex; flex-direction:column; gap:14px;">

          <div>
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
              <span style="font-size:12px; font-weight:600; color:var(--text);">CARDIOPROTECT-II</span>
              <span style="font-size:12px; color:var(--primary);" id="rt-cp2">342 / 500</span>
            </div>
            <div class="enrollment-bar">
              <div class="enrollment-fill" id="rt-cp2-bar" style="width:68.4%"></div>
            </div>
          </div>

          <div>
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
              <span style="font-size:12px; font-weight:600; color:var(--text);">NEURO-RESTORE</span>
              <span style="font-size:12px; color:var(--primary);" id="rt-nr">87 / 300</span>
            </div>
            <div class="enrollment-bar">
              <div class="enrollment-fill" id="rt-nr-bar" style="width:29%"></div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div><!-- /sidebar -->

</div><!-- /main -->

<!-- Footer Links -->
<div class="footer-links">
  <a href="help.html">Help</a>
  <a href="privacy.html">Privacy</a>
  <a href="terms.html">Terms</a>
  <a href="contact.html">Contact</a>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toast-container"></div>

<script>
function generateHash() {
  const chars = '0123456789abcdef';
  let h = '0x';
  for (let i = 0; i < 12; i++) h += chars[Math.floor(Math.random() * chars.length)];
  h += '...' + Array.from({length:4},()=>chars[Math.floor(Math.random()*16)]).join('');
  return h;
}

function generateBlock() {
  return (148204 + Math.floor(Math.random() * 100)).toLocaleString();
}

function generateTxId() {
  return 'TX-' + Date.now().toString(36).toUpperCase() + '-' + Math.random().toString(36).substr(2,5).toUpperCase();
}

async function handleAction(action, trialId, btn) {
  const spinner = btn.querySelector('.spinner');
  btn.disabled = true;
  if (spinner) spinner.style.display = 'inline-block';
  await new Promise(r => setTimeout(r, 1200 + Math.random() * 800));
  btn.disabled = false;
  if (spinner) spinner.style.display = 'none';

  const hash = generateHash();
  const block = generateBlock();
  const txId = generateTxId();

  const labels = {
    'manage': '‚öôÔ∏è Trial Management Opened',
    'add-patient': '‚ûï Patient Data Recorded',
    'report-sae': 'üö® SAE Report Submitted',
    'progress': 'üìä Progress Report Loaded',
    'view-data': 'üìÇ Full Data Access Granted',
    'review-requests': 'üìã Requests Panel Opened',
    'audit-log': 'üîç Audit Log Retrieved',
  };

  showToast(labels[action] || 'Action Completed', `Trial: ${trialId}`, hash, block, txId);
  addChainEntry(labels[action] || 'Action', hash, block, trialId);

  const el = document.getElementById('chain-txs');
  el.textContent = (parseInt(el.textContent.replace(',','')) + 1).toLocaleString();
}

function showToast(title, msg, hash, block, txId) {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-icon">‚úÖ</div>
    <div>
      <div class="toast-title">${title}</div>
      <div class="toast-msg">${msg}</div>
      <div class="toast-hash">${hash} ¬∑ Block #${block}</div>
      <div class="toast-hash" style="color:var(--text-light);">Tx: ${txId}</div>
    </div>
  `;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.animation = 'slideIn 0.3s ease reverse';
    setTimeout(() => toast.remove(), 280);
  }, 4500);
}

function addChainEntry(action, hash, block, trial) {
  const feed = document.getElementById('chain-feed');
  const entry = document.createElement('div');
  entry.className = 'chain-entry';
  entry.style.background = '#fffbeb';
  entry.innerHTML = `
    <div class="chain-entry-top">
      <span class="chain-action">${action.replace(/^[^\s]+\s/, '')}</span>
      <span class="chain-time">Just now</span>
    </div>
    <div class="chain-hash">${hash}</div>
    <div class="chain-block">Block #${block} ¬∑ ${trial}</div>
  `;
  feed.insertBefore(entry, feed.firstChild);
  setTimeout(() => { entry.style.background = ''; }, 2000);
}

function simulateRealtime() {
  setInterval(() => {
    if (Math.random() < 0.4) {
      const cur = parseInt(document.getElementById('cp2-enrolled').textContent);
      const next = Math.min(cur + 1, 500);
      const pct = ((next/500)*100).toFixed(1);
      document.getElementById('cp2-enrolled').textContent = next;
      document.getElementById('cp2-pct').textContent = pct + '%';
      document.getElementById('cp2-bar').style.width = pct + '%';
      document.getElementById('rt-cp2').textContent = `${next} / 500`;
      document.getElementById('rt-cp2-bar').style.width = pct + '%';
    }
    if (Math.random() < 0.25) {
      const cur = parseInt(document.getElementById('nr-enrolled').textContent);
      const next = Math.min(cur + 1, 300);
      const pct = ((next/300)*100).toFixed(1);
      document.getElementById('nr-enrolled').textContent = next;
      document.getElementById('nr-pct').textContent = pct + '%';
      document.getElementById('nr-bar').style.width = pct + '%';
      document.getElementById('rt-nr').textContent = `${next} / 300`;
      document.getElementById('rt-nr-bar').style.width = pct + '%';
    }
    const cp2 = parseInt(document.getElementById('cp2-enrolled').textContent);
    const nr = parseInt(document.getElementById('nr-enrolled').textContent);
    document.getElementById('total-patients').textContent = (cp2+nr+450+278+127).toLocaleString();
  }, 3000);
}

function simulateAccessAlerts() {
  setTimeout(() => {
    showToast('üì© New Access Request', 'WISER-2024-003 ¬∑ Dr. Patel, Johns Hopkins', generateHash(), generateBlock(), generateTxId());
  }, 12000);
  setTimeout(() => {
    showToast('‚ö†Ô∏è Audit Notification', 'WISER-2024-011 ¬∑ FDA pre-inspection notice', generateHash(), generateBlock(), generateTxId());
  }, 24000);
}

function handleLogout(e) {
  e.preventDefault();
  if (confirm('Are you sure you want to logout from WISER?')) {
    const hash = generateHash();
    showToast('üîí Session Ended', 'Logout action recorded on blockchain', hash, generateBlock(), generateTxId());
    setTimeout(() => { window.location.href = 'login.html'; }, 2000);
  }
}

function toggleProfileMenu() {
  window.location.href = 'profile.html';
}

simulateRealtime();
simulateAccessAlerts();
</script>

</body>
</html>